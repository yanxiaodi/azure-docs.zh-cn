---
title: Azure SignalR 服务的性能指南
description: Azure SignalR 服务的性能概述。
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: zhshang
ms.openlocfilehash: 027f9f99161a0e4f76a39a15780bc840380a61ba
ms.sourcegitcommit: 2aefdf92db8950ff02c94d8b0535bf4096021b11
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/03/2019
ms.locfileid: "70232531"
---
# <a name="performance-guide-for-azure-signalr-service"></a>Azure SignalR 服务的性能指南

使用 Azure SignalR 服务的主要好处之一是易于缩放 SignalR 应用程序。 在大规模方案中, 性能是一个重要因素。 

在本指南中, 我们将介绍影响 SignalR 应用程序性能的因素。 我们将在不同用例方案中介绍典型性能。 最后, 我们将介绍可用于生成性能报告的环境和工具。

## <a name="term-definitions"></a>术语定义

*入站*:传入消息到 Azure SignalR 服务。

*出站*:来自 Azure SignalR 服务的传出消息。

*带宽*:1秒内所有消息的总大小。

*默认模式*:创建 Azure SignalR 服务实例时的默认工作模式。 Azure SignalR 服务要求应用服务器在接受任何客户端连接之前与它建立连接。

*无服务器模式*:Azure SignalR 服务仅接受客户端连接的一种模式。 不允许服务器连接。

## <a name="overview"></a>概述

Azure SignalR 服务为不同的性能容量定义了七个标准层。 本指南将回答以下问题:

-   每个层的典型 Azure SignalR 服务性能是多少？

-   Azure SignalR 服务是否满足消息吞吐量的要求 (例如, 每秒发送100000条消息)？

-   对于我的特定方案, 哪一层适合我？ 或者如何选择适当的层？

-   哪种应用服务器 (VM 大小) 适合我？ 应该部署多个应用？

若要回答这些问题, 本指南首先提供影响性能的因素的高级说明。 然后, 它为每个层说明了典型用例的最大入站和出站消息:**回显**、**广播**、**发送到组**和**发送到连接**(对等聊天)。

本指南不能涵盖所有方案 (和不同用例、消息大小、消息发送模式等)。 但它提供了一些方法来帮助你:

- 评估入站或出站消息的大致要求。
- 通过检查性能表查找适当的层。

## <a name="performance-insight"></a>性能见解

本部分介绍性能评估方法, 并列出影响性能的所有因素。 最终, 它提供了一些方法来帮助你评估性能需求。

### <a name="methodology"></a>方法

*吞吐量*和*延迟*是性能检查的两个典型方面。 对于 Azure SignalR 服务, 每个 SKU 层都有自己的吞吐量限制策略。 此策略定义*允许的最大吞吐量 (入站和出站带宽)* , 这是 99% 的消息的延迟小于1秒时达到的最大吞吐量。

滞后时间是从连接发送消息到接收来自 Azure SignalR 服务的响应消息的时间跨度。 让我们以**回显**为例。 每个客户端连接都会在消息中添加一个时间戳。 应用服务器的集线器将原始消息发送回客户端。 因此, 每个客户端连接都可以轻松地计算传播延迟。 对于 "**广播**"、"**发送到组**" 和 "**发送到" 连接**中的每个消息, 都附加了时间戳。

若要模拟成千上万个并发客户端连接, 请在 Azure 中的虚拟专用网络中创建多个 Vm。 所有这些 Vm 均连接到同一个 Azure SignalR Service 实例。

在 Azure SignalR Service 的默认模式下, 应用服务器 Vm 部署在与客户端 Vm 相同的虚拟专用网络中。 所有客户端 Vm 和应用服务器 Vm 都部署在同一区域的同一网络中, 以避免跨区域延迟。

### <a name="performance-factors"></a>性能因素

理论上, Azure SignalR 服务容量受计算资源的限制:CPU、内存和网络。 例如, 更多与 Azure SignalR 服务的连接会导致服务使用更多内存。 对于较大的消息流量 (例如, 每条消息的大小超过2048个字节), Azure SignalR 服务需要花费更多的 CPU 周期来处理流量。 同时, Azure 网络带宽也会对最大流量施加限制。

传输类型是影响性能的另一个因素。 这三种类型分别为[WebSocket](https://en.wikipedia.org/wiki/WebSocket)、[服务器发送事件](https://en.wikipedia.org/wiki/Server-sent_events)和[长轮询](https://en.wikipedia.org/wiki/Push_technology)。 

WebSocket 是一种双向和全双工通信协议, 通过单个 TCP 连接。 服务器发送-事件是将消息从服务器推送到客户端的单向协议。 长轮询要求客户端定期通过 HTTP 请求来轮询服务器中的信息。 对于同一 API, 在相同的情况下, WebSocket 具有最佳性能, 服务器发送事件较慢, 长轮询速度最慢。 默认情况下, Azure SignalR 服务建议 WebSocket。

消息路由开销还限制了性能。 Azure SignalR 服务扮演角色作为消息路由器, 用于将消息从一组客户端或服务器路由到其他客户端或服务器。 不同的方案或 API 需要不同的路由策略。 

对于**echo**, 客户端会向其自身发送消息, 并且路由目标本身也是。 此模式的路由开销最低。 但对于**广播**、"**发送到组**" 和 "**发送到连接**", Azure SignalR 服务需要通过内部分布式数据结构来查找目标连接。 这种额外的处理会使用更多的 CPU、内存和网络带宽。 因此, 性能会降低。

在默认模式下, 应用服务器在某些情况下也可能成为瓶颈。 Azure SignalR SDK 必须调用集线器, 同时通过检测信号信号来维护每个客户端的实时连接。

在无服务器模式下, 客户端通过 HTTP post 发送消息, 这不如 WebSocket 有效。

另一个因素是协议:JSON 和[MessagePack](https://msgpack.org/index.html)。 MessagePack 的大小较小, 传递速度快于 JSON。 不过, MessagePack 可能不会提高性能。 Azure SignalR 服务的性能对协议不敏感, 因为它不会在从客户端到服务器的消息转发期间对消息负载进行解码, 反之亦然。

总而言之, 以下因素会影响入站和出站容量:

-   SKU 层 (CPU/内存)

-   连接数

-   消息大小

-   消息发送速率

-   传输类型 (WebSocket、服务器发送事件或长轮询)

-   用例方案 (路由开销)

-   应用服务器和服务连接 (处于服务器模式)


### <a name="finding-a-proper-sku"></a>查找适当的 SKU

如何评估入站/出站容量或查找哪一层适合特定用例？

假设应用服务器的功能足够强大, 并且不是性能瓶颈。 然后, 检查每个层的最大入站和出站带宽。

#### <a name="quick-evaluation"></a>快速评估

首先, 让我们通过假设某些默认设置来简化评估: 

- 传输类型为 WebSocket。
- 消息大小为2048字节。
- 每隔1秒发送一次消息。
- Azure SignalR 服务处于默认模式。

每个层都有其自己的最大入站带宽和出站带宽。 当入站或出站连接超过此限制后, 不能保证平稳的用户体验。

**Echo**提供最大的入站带宽, 因为它的路由开销最低。 **广播**定义了最大出站消息带宽。

不要超过下面两个表中突出显示的值。

|       传回                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| **入站带宽** | **2 MBps**    | **4 MBps**    | **10 MBps**   | **20 MBps**    | **40 MBps**    | **100 MBps**   | **200 MBps**    |
| 出站带宽 | 2 MBps   | 4 MBps   | 10 MBps  | 20 MBps   | 40 MBps   | 100 MBps  | 200 MBps   |


|     广播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 入站带宽  | 4 KBps   | 4 KBps   | 4 KBps    | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps    |
| **出站带宽** | **4 MBps**    | **8 MBps**    | **20 MBps**    | **40 MBps**    | **80 MBps**    | **200 MBps**    | **400 MBps**   |

*入站带宽*和*出站带宽*是每秒消息的总大小。  下面是它们的公式:
```
  inboundBandwidth = inboundConnections * messageSize / sendInterval
  outboundBandwidth = outboundConnections * messageSize / sendInterval
```

- *inboundConnections*:发送消息的连接数。

- *outboundConnections*:接收消息的连接数。

- *messageSize*:单个消息的大小 (平均值)。 小于1024字节的小消息对性能的影响与1024字节的消息类似。

- *sendInterval*:发送一条消息的时间。 通常每个消息1秒, 这意味着每秒发送一条消息。 间隔较短表示在某个时间段内发送更多消息。 例如, 每条消息0.5 秒表示每秒发送两条消息。

- *连接*：适用于每个层的 Azure SignalR 服务的承诺最大阈值。 如果连接号码进一步增加, 则会受到连接限制。

#### <a name="evaluation-for-complex-use-cases"></a>计算复杂用例

##### <a name="bigger-message-size-or-different-sending-rate"></a>消息大小越大或发送速率不同

实际用例更复杂。 它可能会发送大于2048字节的消息, 或者发送消息速率不是每秒一个消息。 让我们以 Unit100's 广播为例, 了解如何评估其性能。

下表显示了**广播**的实际用例。 但消息大小、连接计数和消息发送速率与上一节中所述的不同。 问题在于, 如果仅了解其中的两项 (消息大小、连接计数或消息发送速率), 我们可以推断出其中的任何项。

| 广播  | 消息大小 | 每秒入站消息数 | 连接 | 发送间隔 |
|---|---------------------|--------------------------|-------------|-------------------------|
| 1 | 20 KB                | 1                        | 100,000     | 5 秒                      |
| 2 | 256 KB               | 1                        | 8,000       | 5 秒                      |

以下公式可根据上一个公式轻松推断:

```
outboundConnections = outboundBandwidth * sendInterval / messageSize
```

对于 Unit100, 从上表中的最大出站带宽为 400 MB。 对于 20 KB 消息大小, 最大出站连接应为 400 MB \* 5/20 KB = 100000, 这与实际值匹配。

##### <a name="mixed-use-cases"></a>混合用例

实际使用事例通常组合四个基本用例:**回显**、**广播**、**发送到组**以及**发送到连接**。 用于评估容量的方法是:

1. 将混合用例划分为四个基本用例。
1. 分别使用上述公式来计算最大入站和出站消息带宽。
1. 对带宽计算求和以获取总入站/出站带宽。 

然后从最大入站/出站带宽表中选取正确的层。

> [!NOTE]
> 若要将消息发送到数百个或数千个小型组, 或数千个客户端发送一条消息, 路由开销将成为主导的。 考虑这种影响。

对于向客户端发送消息的用例, 请确保应用服务器*不*是瓶颈。 以下 "案例研究" 部分提供了有关所需的应用服务器数量以及应配置的服务器连接数的指导原则。

## <a name="case-study"></a>案例研究

以下部分介绍了四种用于 WebSocket 传输的典型用例: **echo**、**广播**、**发送到组**和**发送到连接**。 对于每个方案, 此部分列出了 Azure SignalR 服务的当前入站和出站容量。 还介绍了影响性能的主要因素。

在默认模式下, 应用服务器通过 Azure SignalR 服务创建五台服务器连接。 默认情况下, 应用服务器使用 Azure SignalR Service SDK。 在下面的性能测试结果中, 将服务器连接增加到 15 (或更多), 以便将消息广播并发送到大组。

不同用例对应用服务器有不同的要求。 **广播**需要少量的应用服务器。 **回显**或**发送到连接**需要很多应用服务器。

在所有用例中, 默认消息大小为2048字节, 消息发送间隔为1秒。

### <a name="default-mode"></a>默认模式

客户端、web 应用服务器和 Azure SignalR 服务包含在默认模式下。 每个客户端代表单个连接。

#### <a name="echo"></a>传回

首先, web 应用连接到 Azure SignalR 服务。 其次, 许多客户端连接到 web 应用, 后者使用访问令牌和终结点将客户端重定向到 Azure SignalR 服务。 然后, 客户端与 Azure SignalR 服务建立 WebSocket 连接。

在所有客户端建立连接后, 它们每秒开始向特定集线器发送一条包含时间戳的消息。 中心将消息回显回其原始客户端。 每个客户端在收到回送消息时计算延迟。

在下图中, 5 到 8 (红色突出显示的流量) 处于循环中。 循环运行的时间为默认持续时间 (5 分钟), 并获取所有消息延迟的统计信息。

![Echo 用例的流量](./media/signalr-concept-performance/echo.png)

**Echo**的行为确定最大入站带宽等于最大出站带宽。 有关详细信息, 请参阅下表。

|       传回                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接                       | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 每秒入站/出站消息数 | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 入站/出站带宽 | 2 MBps   | 4 MBps   | 10 MBps  | 20 MBps   | 40 MBps   | 100 MBps  | 200 MBps   |

在此用例中, 每个客户端都调用在应用程序服务器中定义的中心。 集线器只调用原始客户端中定义的方法。 此中心是用于**回显**的最轻量中心。

```
        public void Echo(IDictionary<string, object> data)
        {
            Clients.Client(Context.ConnectionId).SendAsync("RecordLatency", data);
        }
```

即使对于这一简单的中心, 应用服务器上的流量压力也是很明显的, 因为**回显**入站消息负载增加。 此流量压力需要很多适用于大型 SKU 层的应用服务器。 下表列出了每个层的应用服务器计数。


|    传回          | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用服务器计数 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 应用服务器的客户端连接号、消息大小、消息发送速率、SKU 层和 CPU/内存会影响**回送**的总体性能。

#### <a name="broadcast"></a>广播

对于**广播**, 当 web 应用收到消息时, 它将广播到所有客户端。 广播的客户端越多, 发送到所有客户端的消息流量就越多。 请参阅下图。

![广播用例的流量](./media/signalr-concept-performance/broadcast.png)

少量客户端在广播。 入站消息带宽较小, 但出站带宽是巨大的。 当客户端连接或广播速率增加时, 出站消息带宽将增加。

下表总结了最大客户端连接数、入站/出站消息计数和带宽。

|     广播             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒入站消息数  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 每秒出站消息数 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 入站带宽  | 4 KBps   | 4 KBps   | 4 KBps    | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps     |
| 出站带宽 | 4 MBps   | 8 MBps   | 20 MBps   | 40 MBps   | 80 MBps   | 200 MBps   | 400 MBps   |

发布消息的广播客户端不超过四个。 与**echo**相比, 它们需要更少的应用程序服务器, 因为入站消息量很小。 两个应用服务器足以满足 SLA 和性能方面的考虑。 但是, 你应该增加默认的服务器连接以避免不平衡, 尤其是对于 Unit50 和 Unit100。

|   广播      | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用服务器计数 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> 将每个应用服务器上的默认服务器连接数从5增加到 40, 以避免可能与 Azure SignalR 服务的服务器连接不平衡。
>
> 客户端连接号、消息大小、消息发送速率和 SKU 层会影响**广播**的总体性能。

#### <a name="send-to-group"></a>发送到组

"**发送到" 组**用例具有类似于**广播**的流量模式。 不同之处是, 在客户端与 Azure SignalR 服务建立 WebSocket 连接后, 它们必须先加入组, 然后才能将消息发送到特定组。 下图演示了流量流。

![发送到组用例的流量](./media/signalr-concept-performance/sendtogroup.png)

组成员和组计数是影响性能的两个因素。 为了简化分析, 我们定义了两种类型的组:

- **小组**:每个组都有10个连接。 组号等于 (最大连接数)/10。 例如, 对于 Unit1, 如果存在1000连接计数, 则我们有 1000/10 = 100 个组。

- **大组**:组号始终为10。 组成员计数等于 (最大连接数)/10。 例如, 对于 Unit1, 如果存在1000连接计数, 则每个组都有 1000/10 = 100 个成员。

"**发送到组**" 为 Azure SignalR 服务带来了路由开销, 因为它必须通过分布式数据结构查找目标连接。 随着发送连接的增加, 开销会增加。

##### <a name="small-group"></a>小组

路由开销对于将消息发送到多个小型组很重要。 目前, Azure SignalR 服务实现达到了 Unit50 的路由开销限制。 添加更多的 CPU 和内存不起作用, 因此 Unit100 无法在设计后进一步改善。 如果需要更多的入站带宽, 请与客户支持联系。

|   发送到小组     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50 | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|--------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000 | 100,000
| 组成员计数        | 10    | 10    | 10     | 10     | 10     | 10     | 10 
| 组计数               | 100   | 200   | 500    | 1,000  | 2,000  | 5,000  | 10,000 
| 每秒入站消息数  | 200   | 400   | 1,000  | 2,500  | 4,000  | 7,000  | 7,000   |
| 入站带宽  | 400 KBps  | 800 KBps  | 2 MBps     | 5 MBps     | 8 MBps     | 14 MBps    | 14 MBps     |
| 每秒出站消息数 | 2,000 | 4,000 | 10,000 | 25,000 | 40,000 | 70,000 | 70,000  |
| 出站带宽 | 4 MBps    | 8 MBps    | 20 MBps    | 50 MBps     | 80 MBps    | 140 MBps   | 140 MBps    |

许多客户端连接正在调用中心, 因此应用服务器编号也是性能的关键。 下表列出了建议的应用服务器计数。

|  发送到小组   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用服务器计数 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 应用程序服务器的客户端连接号、消息大小、消息发送速率、路由开销、SKU 层和 CPU/内存会影响 "**发送到小型组**" 的总体性能。

##### <a name="big-group"></a>大组

对于 "**发送到大组**", 在达到路由开销限制之前, 出站带宽会成为瓶颈。 下表列出了最大出站带宽, 这与**广播**几乎相同。

|    发送到大组      | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000
| 组成员计数        | 100   | 200   | 500    | 1,000  | 2,000  | 5,000   | 10,000 
| 组计数               | 10    | 10    | 10     | 10     | 10     | 10      | 10
| 每秒入站消息数  | 20    | 20    | 20     | 20     | 20     | 20      | 20      |
| 入站带宽  | 80 KBps   | 40 KBps   | 40 KBps    | 20 KBps    | 40 KBps    | 40 KBps     | 40 KBps     |
| 每秒出站消息数 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 出站带宽 | 8 MBps    | 8 MBps    | 20 MBps    | 40 MBps    | 80 MBps    | 200 MBps    | 400 MBps    |

发送连接计数不超过40。 应用服务器上的负担很小, 因此建议的 web 应用数很小。

|  发送到大组  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用服务器计数 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> 将每个应用服务器上的默认服务器连接数从5增加到 40, 以避免可能与 Azure SignalR 服务的服务器连接不平衡。
> 
> 客户端连接号、消息大小、消息发送速率、路由开销和 SKU 层会影响**发送到大组**的总体性能。

#### <a name="send-to-connection"></a>发送到连接

在 "**发送到连接**" 用例中, 当客户端建立到 Azure SignalR 服务的连接时, 每个客户端都调用一个特殊的中心来获取其自己的连接 ID。 性能基准会收集所有连接 Id 并将其洗牌, 并将其重新分配给作为发送目标的所有客户端。 在性能测试完成之前, 客户端将一直向目标连接发送消息。

![发送到客户端用例的流量](./media/signalr-concept-performance/sendtoclient.png)

**发送到连接**的路由开销类似于**发送到小组**的成本。

随着连接计数的增加, 路由开销会限制整体性能。 Unit50 已达到限制。 因此, Unit100 无法进一步提高。

下表是多轮运行**发送到连接**基准测试后的统计摘要。

|   发送到连接   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50          | Unit100         |
|------------------------------------|-------|-------|-------|--------|--------|-----------------|-----------------|
| 连接                        | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000          | 100,000         |
| 每秒入站/出站消息数 | 1,000 | 2,000 | 5,000 | 8,000  | 9,000  | 20,000 | 20,000 |
| 入站/出站带宽 | 2 MBps    | 4 MBps    | 10 MBps   | 16 MBps    | 18 MBps    | 40 MBps       | 40 MBps       |

此用例需要在应用服务器端进行高负载。 请参阅下表中的建议应用服务器计数。

|  发送到连接  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用服务器计数 | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> 应用服务器的客户端连接号、消息大小、消息发送速率、路由开销、SKU 层和 CPU/内存将影响**发送到连接**的总体性能。

#### <a name="aspnet-signalr-echo-broadcast-and-send-to-small-group"></a>ASP.NET SignalR 回音、广播和发送到小组

Azure SignalR 服务为 ASP.NET SignalR 提供相同的性能容量。 

性能测试使用[标准服务计划 S3](https://azure.microsoft.com/pricing/details/app-service/windows/)的 Azure Web 应用 ASP.NET SignalR。

下表提供了 ASP.NET SignalR **echo**的建议 web 应用计数。

|   传回           | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用服务器计数 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

下表提供了针对 ASP.NET SignalR**广播**建议的 web 应用计数。

|  广播       | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用服务器计数 | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

下表给出了建议的 web 应用计数, 适用于 ASP.NET SignalR**发送到小组**。

|  发送到小组     | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| 连接      | 1,000 | 2,000 | 5,000 | 10,000 | 20,000 | 50,000 | 100,000 |
| 应用服务器计数 | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

### <a name="serverless-mode"></a>无服务器模式

客户端和 Azure SignalR 服务参与到无服务器模式。 每个客户端代表单个连接。 客户端通过 REST API 将消息发送到另一个客户端, 或者将消息广播给所有客户端。

通过 REST API 发送高密度消息不如使用 WebSocket。 它要求您每次都构建一个新的 HTTP 连接, 这是无服务器模式下的额外成本。

#### <a name="broadcast-through-rest-api"></a>广播到 REST API
所有客户端与 Azure SignalR 服务建立 WebSocket 连接。 然后, 某些客户端通过 REST API 开始广播。 发送 (入站) 消息是通过 HTTP Post 实现的, 这不如与 WebSocket 进行比较。

|   广播到 REST API     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒入站消息数  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| 每秒出站消息数 | 2,000 | 4,000 | 10,000 | 20,000 | 40,000 | 100,000 | 200,000 |
| 入站带宽  | 4 KBps    | 4 KBps    | 4 KBps     | 4 KBps     | 4 KBps     | 4 KBps      | 4 KBps      |
| 出站带宽 | 4 MBps    | 8 MBps    | 20 MBps    | 40 MBps    | 80 MBps    | 200 MBps    | 400 MBps    |

#### <a name="send-to-user-through-rest-api"></a>通过 REST API 发送给用户
基准测试将用户名分配给所有客户端, 然后再开始连接到 Azure SignalR 服务。 当客户端与 Azure SignalR 服务建立 WebSocket 连接后, 它们会通过 HTTP Post 开始向其他人发送消息。

|   通过 REST API 发送给用户 | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| 连接               | 1,000 | 2,000 | 5,000  | 10,000 | 20,000 | 50,000  | 100,000 |
| 每秒入站消息数  | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000  |
| 每秒出站消息数 | 300   | 600   | 900    | 1,300  | 2,000  | 10,000  | 18,000 |
| 入站带宽  | 600 KBps  | 1.2 MBps  | 1.8 MBps   | 2.6 MBps   | 4 MBps     | 10 MBps     | 36 MBps    |
| 出站带宽 | 600 KBps  | 1.2 MBps  | 1.8 MBps   | 2.6 MBps   | 4 MBps     | 10 MBps     | 36 MBps    |

## <a name="performance-test-environments"></a>性能测试环境

对于前面列出的所有用例, 我们在 Azure 环境中执行了性能测试。 大多数情况下, 我们使用的是50客户端 Vm 和20个应用服务器 Vm。 下面是一些详细信息:

- 客户端 VM 大小:StandardDS2V2 (2 vCPU, 7G memory)

- 应用服务器 VM 大小:StandardF4sV2 (4 vCPU, 8G memory)

- Azure SignalR SDK 服务器连接:15

## <a name="performance-tools"></a>性能工具

可在[GitHub](https://github.com/Azure/azure-signalr-bench/)上找到 Azure SignalR 服务的性能工具。

## <a name="next-steps"></a>后续步骤

本文概述典型用例方案中的 Azure SignalR 服务性能。

若要获取有关服务的内部和缩放的详细信息, 请参阅以下指南:

* [Azure SignalR 服务内部](signalr-concept-internals.md)
* [Azure SignalR 服务缩放](signalr-howto-scale-multi-instances.md)
