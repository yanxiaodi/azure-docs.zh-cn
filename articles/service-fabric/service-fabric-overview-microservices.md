---
title: Azure 上的微服务简介 | Microsoft Docs
description: 概述为何使用微服务方法构建云应用程序对于开发现代应用程序非常重要，以及 Azure Service Fabric 如何提供一个平台用于实现此目的。
services: service-fabric
documentationcenter: .net
author: athinanthny
manager: chackdan
editor: ''
ms.assetid: fae2be85-0ab4-4cd3-9d1f-e0d95fe1959b
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: conceptual
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/18/2019
ms.author: atsenthi
ms.openlocfilehash: 5bcb52165c7cae18b807eff03c80b51eae8e2717
ms.sourcegitcommit: b7a44709a0f82974578126f25abee27399f0887f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/18/2019
ms.locfileid: "67204805"
---
# <a name="why-use-a-microservices-approach-to-building-applications"></a>为何使用微服务方法构建应用程序？

对于软件开发人员，分解成组件部分的应用程序是什么新鲜事物。 通常情况下，一种分层的方法使用，与后端存储、 中间层业务逻辑和前端用户界面 (UI)。 什么*具有*过去几年更改为开发人员构建分布式的云应用程序。

下面是一些不断变化的业务需求：

* 生成并运营规模达到新的地理区域中的客户服务。
* 特性和功能，以采用敏捷方式响应客户需求的速度更快交付。
* 提高资源利用率以降低成本。

这些业务要求影响我们*如何*构建应用程序。

有关信息的 Azure 微服务方法的详细信息，请参阅[微服务：由云支持的应用程序变革](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)。

## <a name="monolithic-vs-microservices-design-approach"></a>整体化与微服务设计方法

应用程序会随着时间而发展。 成功的应用程序因为有实用性而发展。 失败的应用程序不不断向前发展，最终不推荐使用。 下面是这个问题： 多少了解您的要求目前和将来他们就是？ 例如，假设您要在你的公司构建部的报告应用程序。 您确定应用程序将仅在你的公司范围内，并且，报表不会保存在长。 所用的方法是不同的说，为构建服务向数千万个客户提供视频内容。

有时，获取外寻求概念证明才是驱动因素。 您知道可以更高版本重新设计应用程序。 不存在过度设计内容根本就没有使用的小点。 另一方面，公司针对云进行构建，假定条件下时，成长和使用量。 成长和规模不可预知。 我们希望原型快速同时也知道，我们可以处理将来的成功路径上。 这是简练的启动方法：构建、测量、学习和迭代。

在客户端/服务器时代，我们倾向专注于构建分层式应用程序在每个层中使用特定技术。 术语*整体式*已经出现了应用程序来描述这些方法。 接口通常存在于各层之间，而在一层内的各组件之间采用更紧密耦合的设计。 开发人员设计并分解已编译为库并链接到几个可执行文件和 Dll 在一起的类。

没有为单一式设计方法带来的好处。 单一式应用程序通常是设计较简单和组件间的调用是速度更快，因为这些调用通常是通过进程间通信 (IPC)。 此外，每个人都只测试单一产品，这往往是人力资源更有效地使用。 缺点是分层之间紧密耦合，无法缩放各个组件。 如果需要执行修复或升级，你必须等待其他人完成其测试。 它很难变得敏捷。

微服务解决了这些缺点，并更密切配合上述业务要求。 但它们也有优点和缺点。 微服务的优点是通常各自封装较为简单的业务功能，可独立缩放、测试、部署和管理。 微服务方法的一个重要优势是，团队根据业务方案的详细技术。 较小的团队开发基于客户的应用场景的微服务，并使用他们想要使用任何技术。

换句话说，组织不需要为了维护微服务应用程序而将技术标准化。 拥有服务的单个团队可以根据团队的专业知识，或什么最适合解决问题，各自发挥所长。 在实践中，一组建议的技术，如特定的 NoSQL 存储或 web 应用程序框架，更可取。

微服务的缺点是，您需要管理更多独立的实体并处理更复杂的部署和版本控制。 微服务之间的网络流量增加，因为执行相应的网络延迟。 大量琐碎的精细服务可能会导致性能噩梦。 如果没有工具帮助您查看这些依赖项，很难看到整个系统。

标准使微服务方法，通过指定如何进行通信并接受仅关注需要从一种服务，工作，而不是严格协定。 请务必在设计中定义预先这些协定，因为服务均可独立更新。 在设计微服务方法时出现的另一个描述是“面向服务的精细体系结构 (SOA)”。

***简单地说，微服务设计方法是分离的服务，具有各自独立更改和一致的标准通信的联合。***

随着更多云应用程序会生成，人们发现此分解成独立、 方案焦点式服务的整体应用程序是一种更好的长期方法。

## <a name="comparison-between-application-development-approaches"></a>应用程序开发方法的比较

![Service Fabric 平台应用程序开发][Image1]

1) 整体式应用程序包含特定于域的功能，并通常划分为像 web、 业务和数据的功能层。

2) 通过克隆多个服务器/虚拟机上缩放整体式应用程序/容器。

3) 微服务应用程序将单个功能分隔成单个较小的服务。

4) 微服务方法可通过独立部署每个服务而扩展，跨服务器/虚拟机/容器创建这些服务的实例。

使用微服务设计方法不是适用于所有项目，但它确实更符合前面所述的业务目标。 如果您知道将有机会以微服务设计的更高版本重新编写代码，从单一式方法可能会有用。 更常见的是，从单一式应用程序入手，分阶段慢慢分解它（从需要提高可缩放性或敏捷性的功能区域开始）。

当使用微服务方法时，编写许多小型服务应用程序。 在跨计算机群集的部署的容器中运行这些服务。 较小的团队开发针对方案的服务和独立进行测试、 版本、 部署和扩展每个服务，因此可以改进整个应用程序。

## <a name="what-is-a-microservice"></a>什么是微服务？

微服务存在多种定义。 但广泛接受的大部分微服务的以下特征：

* 封装客户方案或业务方案。 要解决什么问题？
* 由小型工程团队开发。
* 在任何编程语言中，使用任何框架编写。
* 包含代码，并可以选择状态，这两个独立控制版本、 部署和缩放。
* 通过定义完善的接口和协议来与其他微服务交互。
* 具有唯一名称 (Url)，用于解析其位置。
* 在出现故障时可保持一致且可用。

总而言之，：

***微服务应用程序由独立控制版本和可缩放的、以客户为中心的服务组成，这些服务通过标准协议和定义完善的接口彼此通信。***

### <a name="written-in-any-programming-language-using-any-framework"></a>在任何编程语言中，使用任何框架编写

作为开发人员，我们想要随意选择的语言或框架，具体取决于我们的技能和我们要创建的服务的需求。 对于某些服务，可能值的性能优势C++上面任何其他操作。 对于其他操作系统，从获取的托管开发的易用性C#或 Java 可能是更重要的。 在某些情况下，可能需要用于特定合作伙伴库、 数据存储技术或方法将向客户端服务公开。

选择一种技术后，您需要考虑操作或生命周期管理和缩放的服务。

### <a name="allows-code-and-state-to-be-independently-versioned-deployed-and-scaled"></a>允许独立控制版本、部署及缩放的代码和状态

无论您编写的方式在微服务、 代码，以及 （可选） 状态，应单独部署、 升级和缩放。 此问题很难解决由于这取决于所选的技术。 缩放，了解如何分区 （或分片） 代码和状态是一个挑战。 当代码和状态使用不同的技术，目前不常见，微服务的部署脚本需要能够扩展这两个。 这种分离也是有关敏捷性和灵活性，因此可以无需同时升级所有这些升级某些微服务。

让我们返回到我们的一段时间的整体化和微服务方法的比较。 此图显示了存储状态的方法中的差异：

#### <a name="state-storage-for-the-two-approaches"></a>两种方法的状态存储

![Service Fabric 平台状态存储][Image2]

***单一式方法，在左侧，有一个单一数据库和层的特定技术。***

***微服务方法中，在右侧，有互连的微服务的状态通常应用范围限定为微服务和使用各种技术关系图。***

在单一式方法中，应用程序通常使用单一数据库。 使用一个数据库的优点是，它是在一个位置，这样更易于部署。 每个组件可以通过单个表来存储其状态。 困难之处在于团队必须严格区分状态。 不可避免地，我们不久就会想要向现有客户表中添加列、 表之间执行联接和存储层形成依赖性。 发生这种情况后，无法缩放各个组件。

在微服务方法中，每个服务都管理并存储自己的状态。 每个服务将负责同时缩放代码和状态，以满足服务的需求。 不足的是，当您需要创建视图或查询的应用程序的数据，你需要跨多个状态存储进行查询。 通常通过单独的微服务的一系列微服务生成的视图，解决此问题。 如果需要对数据运行多个即席查询，则应考虑每个微服务的数据写入数据仓库服务以供脱机分析。

微服务进行版本控制。 就可以针对不同版本的并行运行的微服务。 微服务的较新版本无法在升级过程失败，并且需要将其回滚到早期版本。 版本控制技术还有助于对于 A / B 测试，其中不同的用户体验不同版本的服务。 例如，它是常见升级微服务的一组特定的客户可以将它广泛应用的详细信息之前，测试新功能。

### <a name="interacts-with-other-microservices-over-well-defined-interfaces-and-protocols"></a>通过定义完善的接口和协议来与其他微服务交互

在过去 10 年中，大量信息已发布描述面向服务的体系结构中的通信模式。 一般而言，服务通信使用 REST 方法，并配合 HTTP 与 TCP 协议及 XML 或 JSON 作为序列化格式。 从接口的角度看，这就是采用 web 设计方法。 但不是应阻止您使用二进制协议或您自己的数据格式。 只需注意，用户将有较难使用微服务，如果这些协议和格式并不公开可用。

### <a name="has-a-unique-name-url-used-to-resolve-its-location"></a>具有用来解析位置的唯一名称 (URL)

微服务需是可寻址的只要它正在运行。 如果您认为有关机的信息，哪一个正在运行特定微服务，可能会错误快速。

就像 DNS 解析特定计算机的特定 URL 一样，微服务需要有唯一的名称来发现它目前所在的位置。 微服务需要可寻址的名称，独立于其运行的基础结构。 这意味着由于存在需要服务注册表没有如何部署你的服务和发现方式之间的交互。 当一台计算机失败时，需要告诉您，该服务已移至注册表服务。

### <a name="remains-consistent-and-available-in-the-presence-of-failures"></a>在出现故障时可保持一致且可用

处理意外的故障是最难解决的问题之一，特别是在分布式系统中。 我们作为开发人员编写大部分是代码的用于处理异常。 在测试期间，我们也会花费时间最多异常处理。 该过程是比编写代码来处理故障更为复杂。 在其运行的微服务在计算机出现故障时，会发生什么情况？ 您需要检测故障，这是本身是一个难题。 但您还需要重新启动微服务。

可用性、 微服务需要可灵活处理故障并能够在另一台计算机上重新启动。 除了这些可恢复性要求，数据不应将丢失，并且数据需要保持一致。

如果在应用程序升级期间发生故障，则很难实现复原。 在配合部署系统一起运行时，微服务不仅需要恢复。 它需要确定是否要继续向前移动到较新版本或回滚到旧版以维持一致的状态。 您需要考虑几个问题，如足够多的计算机是否可用于继续更新以及如何恢复以前版本的微服务。 要做出这些决策，您需要在微服务发出运行状况信息。

### <a name="reports-health-and-diagnostics"></a>报告运行状况和诊断

这看起来可能很明显，并经常被忽略，但微服务需要报告其运行状况和诊断。 否则，您必须很少深入了解其运行状况： 从操作角度来说。 面临的难题是关联一组独立服务的诊断事件并修正计算机时钟偏差以识别事件顺序。 同样地，通过议定的协议和数据格式来与微服务交互时，需要将运行状况和诊断事件的记录方式标准化，这些事件最终将写入可供查询和查看的事件存储。 微服务方法，不同的团队需要达成单个日志记录格式。 需要有一致的方法来查看整个应用程序中的诊断事件。

运行状况与诊断不同。 运行状况是指微服务报告其当前状态，以便采取适当的措施。 一个很好的例子便是使用升级和部署机制来保持可用性。 尽管一个服务可能由于进程崩溃是当前不正常或计算机重启，可能仍可运行该服务。 所需的最后一步是通过启动升级使情况变得更糟。 最佳方法是先调查或留出时间进行恢复的微服务。 微服务中的运行状况事件可以帮助我们制定明智的决策，并且实际上也有助于创建自愈服务。

## <a name="guidance-for-designing-microservices-on-azure"></a>Azure 上设计微服务的指南 
在访问 Azure 体系结构中心指南[设计和构建微服务在 Azure 上](https://docs.microsoft.com/azure/architecture/microservices/)。

## <a name="service-fabric-as-a-microservices-platform"></a>Service Fabric 作为微服务平台

Microsoft 从提供的服务提供盒装的产品，通常是单一式，转换时，azure Service Fabric 横空问世。 构建和运营大型服务，如 Azure SQL 数据库和 Azure Cosmos DB 的经验造就了 Service Fabric。 在平台随着时间不断演变更多服务采用它。 Service Fabric 不仅要在 Azure 中运行，还要在独立的 Windows Server 部署中运行。

***Service Fabric 的目的是为了解决构建和运行服务方面的难题，并有效地使用基础结构资源，因此团队通过使用微服务方法来解决业务问题。***

Service Fabric 可帮助你构建使用微服务方法的应用程序，它提供：

* 提供系统服务的平台，用于部署、升级、检测和重启失败的服务、发现服务、路由消息、管理状态和监视运行状况。
* 能够部署在容器中或作为进程运行的应用程序。 Service Fabric 是容器和进程 Orchestrator。
* 若要帮助您构建微服务的应用程序的生产编程 Api:[ASP.NET Core、Reliable Actors 和 Reliable Services](service-fabric-choose-framework.md)。 例如，可以获取运行状况和诊断信息，或利用内置的高可用性。

***Service Fabric 并不知道有关如何构建你的服务，并且可以使用任何技术。但它提供内置编程 Api，使其更轻松地生成微服务。***

### <a name="migrating-existing-applications-to-service-fabric"></a>将现有应用程序迁移到 Service Fabric

Service Fabric 允许您重用现有代码，让其现代化与新的微服务。 有五个阶段应用程序现代化，并可以启动和停止在任何阶段。 阶段包括：

1) 从传统单一式应用程序入手。  
2) 迁移。 使用容器或来宾可执行文件托管在 Service Fabric 中的现有代码。  
3) 实现现代化。 添加新的微服务与现有容器化代码一起。  
4) 创新。 单一式应用程序分解为微服务根据需求。  
5) 转换为微服务的应用程序。 转换现有单一式应用程序或生成新领域应用程序。

![迁移到微服务][Image3]

请记住，你可以*在任意阶段开始和停止*。 你没有前进到下一阶段。 

让我们看看示例每个阶段。

**迁移**  
两个原因，许多公司要迁移到容器的现有单一式应用程序：

* 成本的降低，由于整合和移除现有硬件或由于在更高的密度运行的应用程序。
* 开发和运营之间一致的部署协定。

多来成本的降低非常简单。 在 Microsoft，许多现有应用程序正在进行容器化，从而导致数以百万计的美元的成本节约。 一致的部署是难以评估，但同样重要。 这意味着开发人员可以选择根据它们的技术，但操作将接受方法只有一个用于部署和管理应用程序。 它减少了从无需处理而不会迫使开发人员可以选择仅特定技术支持不同的技术的复杂操作。 从根本上来说，每个应用程序都容器化到独立式的部署映像。

许多组织止步于这一阶段。 他们已有的容器，好处和 Service Fabric 提供了完整的管理体验，包括部署、 升级、 版本控制、 回滚、 和运行状况监视。

**实现现代化**  
现代化是的新服务与现有容器化代码一起添加。 如果您要编写新代码，最好下微服务路径的几步。 这可能意味着添加新的 REST API 终结点或新的业务逻辑。 这样一来，您开始构建新的微服务并进行开发和部署它们的过程。

**创新**  
微服务方法可适应不断变化的业务需求。 在此阶段，您需要决定是否开始拆分将整体式应用程序服务，或进行创新。 当使用作为工作流队列的数据库将成为处理瓶颈时，典型的示例。 随着工作流请求数量不断增加，需要分布工作，以实现缩放。 需要的应用程序，不能扩展，或需要更频繁地更新并将其扩展拆分为微服务和创新该特定的部分。

**转换为微服务的应用程序**  
在此阶段，你的应用程序是完全的组合 （或拆分成） 微服务。 若要达到此限制，您已微服务之旅。 您可以从此阶段开始，但为此，而无需使用微服务平台，帮助你需要投入大量资金。

### <a name="are-microservices-right-for-my-application"></a>微服务适合我的应用程序吗？

也许。 在 Microsoft，随着更多团队开始构建云应用出于业务原因，其中许多意识到采用类似微服务的方法的优势。 必应，例如，一直在使用微服务多年。 微服务方法对于其他团队而言相当新颖。 团队发现需要解决一些疑难问题，但这并非他们的强项。 这是 Service Fabric 受到重视的技术构建的服务的原因。

Service Fabric 的目的是减少构建微服务应用程序，因此不需要经历多成本高昂的重新设计的复杂性。 从小规模开始，按需缩放，淘汰旧服务，添加新服务，并随着客户用量的增加而改进。 我们也知道，为了让微服务更易于为大部分开发人员所接受，还有许多其他尚待解决的问题。 容器和执行组件编程模型是在该方向的小步骤的示例。 我们确定更多的创新应运而生，微服务方法更轻松。


## <a name="next-steps"></a>后续步骤

* [微服务：由云驱动的应用程序革命](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)
* [Azure 体系结构中心：在 Azure 上构建微服务](https://docs.microsoft.com/azure/architecture/microservices/)
* [Azure Service Fabric 应用程序和群集的最佳做法](service-fabric-best-practices-overview.md)
* [Service Fabric 术语概述](service-fabric-technical-overview.md)

[Image1]: media/service-fabric-overview-microservices/monolithic-vs-micro.png
[Image2]: media/service-fabric-overview-microservices/statemonolithic-vs-micro.png
[Image3]: media/service-fabric-overview-microservices/microservices-migration.png
