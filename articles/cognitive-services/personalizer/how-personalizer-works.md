---
title: 个性化体验创建服务的工作原理 - 个性化体验创建服务
titleSuffix: Azure Cognitive Services
description: 个性化体验创建服务使用机器学习来发现要在上下文中使用的操作。 每个学习循环都包含一个模型，该模型是专门使用通过排名和奖励调用发送的数据训练的。 各个学习循环彼此完全独立。
author: diberry
manager: nitinme
ms.service: cognitive-services
ms.subservice: personalizer
ms.topic: conceptual
ms.date: 09/13/2019
ms.author: diberry
ms.openlocfilehash: 7c163dacae24749dbe309bca33bac016a3be7aa5
ms.sourcegitcommit: e97a0b4ffcb529691942fc75e7de919bc02b06ff
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/15/2019
ms.locfileid: "71002892"
---
# <a name="how-personalizer-works"></a>个性化体验创建服务的工作原理

个性化体验创建服务使用机器学习来发现要在上下文中使用的操作。 每个学习循环都包含一个模型，该模型是专门使用通过**排名**和**奖励**调用发送的数据训练的。 各个学习循环彼此完全独立。 为要个性化的应用程序的每个部分或行为创建一个学习循环。

对于每个循环，请根据当前上下文使用以下语句**调用排名 API**：

* 可能的操作列表：要从中选择最相关操作的内容项。
* [上下文特征](concepts-features.md)列表：上下文相关的数据，例如用户、内容和上下文。

**排名** API 将决定使用以下操作之一：

* _利用_：当前模型根据以往的数据确定最佳操作。
* _探索_：选择不同的操作而不是最相关的操作。

**奖励** API：

* 通过记录每个排名调用的特征和奖励评分来收集用于训练模型的数据。
* 根据学习策略中指定的设置，使用该数据更新模型。

## <a name="architecture"></a>体系结构

下图显示了排名和奖励调用的体系结构流程图：

![替代文本](./media/how-personalizer-works/personalization-how-it-works.png "个性化工作原理")

1. 个性化体验创建服务使用内部的 AI 模型来确定操作的排名。
1. 该服务会确定是要利用当前模型，还是探索模型的新选项。  
1. 排名结果将发送到事件中心。
1. 当个性化体验创建服务收到奖励时，会将奖励发送到事件中心。 
1. 排名和奖励相关联。
1. 根据关联结果更新 AI 模型。
1. 使用新模型更新推理引擎。 

## <a name="research-behind-personalizer"></a>个性化体验创建服务幕后的研究

个性化体验创建服务基于[强化学习](concepts-reinforcement-learning.md)领域的前沿科研成果，包括 Microsoft 研究部门的论文、研究活动和持续探索。

## <a name="terminology"></a>术语

* **学习循环**：可为受益于个性化的应用程序的每个部分创建学习循环。 如果需要个性化多个体验，请为每个体验创建一个循环。 

* **操作**：操作是可供选择的内容项，例如产品或促销。 个性化体验创建服务通过排名 API 选择要向用户显示的最相关操作，称为“奖励操作”。 每个操作可以包含连同排名请求一起提交的特征。

* **Context**：若要提供更准确的排名，请提供有关上下文的信息，例如：
    * 你的用户。
    * 用户所用的设备。 
    * 当前时间。
    * 有关当前情况的其他数据。
    * 有关用户或上下文的历史数据。

    特定的应用程序可能具有不同的上下文信息。 

* **[特征](concepts-features.md)** ：有关内容项或用户上下文的信息单元。

* **回馈**：度量用户如何对排名 API 返回的操作做出响应，评分为 0 到 1。 0 到 1 的值由业务逻辑设置，依据是所做的选择对实现个性化业务目标提供了多大的帮助。 

* **探索**：个性化体验创建服务会探索何时要为用户选择不同的操作，而不是返回最佳操作。 个性化体验创建服务可以避免偏差、停滞，并可通过探索来适应现行的用户行为。 

* **试验持续时间**：个性化体验创建服务等待返回奖励的时间长短，从该事件发生排名调用开始计算。

* **非活动事件**：非活动事件是调用了排名，但不确定用户是否会看到结果（因为客户端应用程序的决策）的事件。 使用非活动事件可以创建和存储个性化结果，然后决定放弃这些结果，而不会影响机器学习模型。

* **模型**：个性化体验创建服务模型捕获习得的有关用户行为的数据，从发送到排名和奖励调用的参数组合中获取训练数据，并提供学习策略确定的训练行为。 

* **学习策略**:Personalizer 在每个事件上定型模型的方式取决于一些会影响机器学习算法工作方式的元参数。 新的 Personalizer 循环将以默认的学习策略开始, 这可能会产生适度的性能。 运行[评估](concepts-offline-evaluation.md)时, Personalizer 可以创建专门优化到循环使用情况的新学习策略。 对于在评估过程中生成的每个特定循环, Personalizer 将显著提高性能。

## <a name="example-use-cases-for-personalizer"></a>个性化体验创建服务的用例

* 意向澄清和消除歧义：当用户的意向不明时，通过为每个用户提供个性化的选项，帮助他们获得更好的体验。
* 菜单和选项的默认建议：让机器人首先以个性化方式建议最可能的项，而不是显示没有人情味的菜单或备选项列表。
* 机器人特征和音调：对于可以改变音调、话语冗长性和书写方式的机器人，请考虑以个性化方式改变这些特征。
* 通知和警报内容：决定要在警报中使用哪些文本，以提高用户的参与度。
* 通知和警报时间：以个性化方式学习何时要将通知发送给用户，以提高其参与度。

## <a name="how-to-use-personalizer-in-a-web-application"></a>如何在 Web 应用程序中使用个性化体验创建服务

将一个循环添加到 Web 应用程序，包括：

* 确定要个性化的体验、现有的操作和特征、要使用的上下文特征，以及要设置的奖励。
* 在应用程序中添加对个性化 SDK 的引用。
* 准备好个性化时，调用排名 API。
* 存储 eventId。 稍后要使用奖励 API 发送奖励。
1. 确保用户已看到你的个性化页面后，针对事件调用“激活”。
1. 等待用户选择已排名的内容。 
1. 调用奖励 API 来指定排名 API 的输出准确性。

## <a name="how-to-use-personalizer-with-a-chat-bot"></a>如何在聊天机器人中使用个性化体验创建服务

本示例演示如何使用个性化做出默认建议，而不是每次向用户发送一系列的菜单或选项。

* 获取本示例的[代码](https://github.com/Azure-Samples/cognitive-services-personalizer-samples/tree/master/samples/ChatbotExample)。
* 设置机器人解决方案。 确保发布 LUIS 应用程序。 
* 管理机器人的排名和奖励 API 调用。
    * 添加用于管理 LUIS 意向处理的代码。 如果返回了 **None** 作为首要意向，或者首要意向评分低于业务逻辑阈值，请将意向列表发送到个性化体验创建服务以便为意向排名。
    * 以可选择的链接形式向用户显示意向列表，其中的第一个意向是排名 API 响应中排名最靠前的意向。
    * 捕获用户的选择并在奖励 API 调用中发送此信息。 

### <a name="recommended-bot-patterns"></a>建议的机器人模式

* 每当需要消除歧义时，都发出个性化体验创建服务排名 API 调用，而不要缓存每个用户的结果。 某个人的意向消除歧义结果可能会在一段时间后有变化，允许排名 API 探索差异可以加速总体学习过程。
* 选择许多用户共有的交互，以获得足够的可个性化数据。 例如，在只有少量用户访问的聊天图中，使用引导性的问题可能比稍微深入的澄清更合适。
* 使用排名 API 调用来实现“第一条建议适当”聊天，问用户“你想要 X 吗？” 或“你是指 X 吗？” 而用户只需确认；不要向用户提供他们必须从菜单中选择的选项。 例如，用户说：“我想买一杯咖啡”，机器人说：“你想要双倍特浓咖啡吗？”。 这样，奖励信号也很明确，因为它与一条建议直接相关。

## <a name="how-to-use-personalizer-with-a-recommendation-solution"></a>如何在推荐解决方案中使用个性化体验创建服务

使用推荐引擎可将一个大型目录筛选为少量的几个项，然后，可将其显示为要发送到排名 API 的 30 个可能的操作。

可将推荐引擎与个性化体验创建服务配合使用：

* 设置[推荐解决方案](https://github.com/Microsoft/Recommenders/)。 
* 显示某个页面时，调用推荐模型以获取简短的推荐列表。
* 调用个性化来为推荐解决方案的输出排名。
* 使用奖励 API 调用发送有关用户操作的反馈。


## <a name="pitfalls-to-avoid"></a>需避免的错误

* 如果个性化的行为可在所有用户那里发现，而不是要为特定用户记住的行为，或者来自用户特定的备选项列表，请不要使用个性化体验创建服务。 例如，使用个性化体验创建服务从包含 20 个可能菜单项的列表中推荐最合适的披萨是有用的做法，但是，在幼儿园需要帮助时，确定要呼叫用户联系人列表中的哪个联系人（例如“奶奶”）对于用户群而言并不是一个适合个性化的用例。


## <a name="adding-content-safeguards-to-your-application"></a>将内容保护措施添加到应用程序

如果应用程序允许向用户显示差别很大的内容，而其中的某些内容对于某些用户而言不安全或者不妥，则你应该提前确保采用适当的保护措施，以防用户看到不可接受的内容。 实施保护措施的最佳模式是：
    * 获取要排名的操作列表。
    * 筛选出对受众不可行的操作。
    * 仅为可行的操作排名。
    * 向用户显示排名最高的操作。

在某些体系结构中，可能很难按上述顺序实施保护措施。 在这种情况下，可以在排名后通过一种替代的方法来实施保护措施，但这需要经过预配，以便未受保护的措施不会用于训练个性化体验创建服务模型。

* 在停用学习的情况下获取要排名的操作列表。
* 为操作排名。
* 检查排名最高的操作是否可行。
    * 如果排名最高的操作可行，则激活此排名的学习，然后向用户显示。
    * 如果排名最高的操作不可行，请不要激活此排名的学习，并通过自己的逻辑或替代的方法决定要向用户显示哪些内容。 即使使用排名第二的选项，也不要激活此排名的学习。

## <a name="verifying-adequate-effectiveness-of-personalizer"></a>验证个性化体验创建服务有效性是否足够

可以定期执行[脱机评估](how-to-offline-evaluation.md)来监视个性化体验创建服务的有效性。

## <a name="next-steps"></a>后续步骤

了解[可在何处使用个性化体验创建服务](where-can-you-use-personalizer.md)。
执行[脱机评估](how-to-offline-evaluation.md)
