---
title: 教程：特征化和特征规范 - 自定义 AI 决策服务
titlesuffix: Azure Cognitive Services
description: 自定义决策服务中的机器学习特征化和特征规范教程。
services: cognitive-services
author: slivkins
manager: nitinme
ms.service: cognitive-services
ms.subservice: custom-decision-service
ms.topic: tutorial
ms.date: 05/08/2018
ms.author: slivkins
ROBOTS: NOINDEX
ms.openlocfilehash: 409dcf7dc224eaf2a3f51325010507b9182fadf2
ms.sourcegitcommit: ad9120a73d5072aac478f33b4dad47bf63aa1aaa
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/01/2019
ms.locfileid: "68707043"
---
# <a name="tutorial-featurization-and-feature-specification"></a>教程：特征化和特征规范

此教程解决了自定义 AI 决策服务中的高级机器学习功能。 此教程包含两部分：[特征化](#featurization-concepts-and-implementation)和[特征规范](#feature-specification-format-and-apis)。 特征化指将数据表示为机器学习的“特征”。 特征规范涵盖用于指定特征的 JSON 格式和辅助 API。

默认情况下，自定义 AI 决策服务中的机器学习对客户透明。 自动从内容中提取特征，并使用标准强化学习算法。 特征提取会利用几种其他 Azure 认知服务：[实体链接](../entitylinking/home.md)、[文本分析](../text-analytics/overview.md)、[情感](../emotion/home.md)、[计算机视觉](../computer-vision/home.md)。 如果仅使用默认功能，可以跳过此教程。

## <a name="featurization-concepts-and-implementation"></a>特征化：概念和实现

自定义 AI 决策服务逐一制定决策。 每个决策涉及从多个替代项中进行选择，也称为“操作”。 根据应用程序，决策可能选择单个操作或操作的（短）排名列表。

例如，在网站首页个性化文章选择。 在这里，操作对应于文章，每个决策是要向给定用户显示哪个文章。

每个操作由属性的矢量表示，此后称为“特征”  。 除了自动提取的特征，还可以指定新特征。 还可以命令自定义 AI 决策服务记录一些特征，但机器学习中忽略这些特征。

### <a name="native-vs-internal-features"></a>本机与内部特征

可以按应用程序最自然的格式指定特征，如数字、字符串或数组。 这些特征称为“本机特征”。 自定义 AI 决策服务将每个本机特征转换为一个或多个数字特征，称为“内部特征”。

按以下方式转换为内部特征：

- 数字特征保持不变。
- 数值数组转换为多个数字特征，分别对应于数组的每个元素。
- 字符串值特征 `"Name":"Value"` 默认转换为具有名称 `"NameValue"` 和值 1 的特征。
- 可选，可以将字符串表示为[词包](https://en.wikipedia.org/wiki/Bag-of-words_model)。 然后，为字符串中的每个词创建内部特征，其值是该词的出现次数。
- 忽略零值内部特征。

### <a name="shared-vs-action-dependent-features"></a>共享与操作从属特征

某些特征指整个决策，且对于所有操作都是相同的。 我们将其称为“共享特征”  。 某些其他特征特定于特定操作。 我们将其称为“操作从属特征”  (ADF)。

在运行示例中，共享特征可以描述用户和/或世界状态。 地理位置、用户年龄和性别等特征，以及即将发生的主要事件。 操作从属特征可以描述给定文章的属性，如此文章中涵盖的主题。

### <a name="interacting-features"></a>交互特征

特征通常“交互”：某项的影响取决于其他项。 例如，特征 X 是用户是否对运动感兴趣。 特征 Y 是给定文章是否与运动相关。 那么，特征 Y 的影响主要取决于特征 X。

要考虑特征 X 和 Y 之间的交互，请创建“二次”  特征，其值为 X\*Y。 （也称为，X 和 Y“交叉”。）可以选择哪对特征交叉。

> [!TIP]
> 共享特征应与操作从属特征交叉，以便影响其级别。 操作从属特征应与共享特征交叉，以便影响个性化。

换而言之，未与任何 ADF 交叉的共享特征会以相同方式影响每个操作。 未与任何共享特征交叉的 ADF 也会影响每个决策。 这些类型的特征可能会降低回报评估的方差。

### <a name="implementation-via-namespaces"></a>通过命名空间实现

可以通过门户上的“VW 命令行”实现交叉的特征（以及其他特征化概念）。 语法基于 [Vowpal Wabbit](http://hunch.net/~vw/) 命令行。

实现的焦点是“命名空间”  概述：命名的特征子集。 每个特征只属于一个命名空间。 将特征值提供给自定义 AI 决策服务时，可以显式指定命名空间。 在 VW 命令行中，这是参考特征的唯一方法。

命名空间是“共享”或“操作从属”：它仅包含共享特征，或仅包含相同操作的操作从属特征。

> [!TIP]
> 最好在显式指定的命名空间中包装特征。 在相同命名空间中分组相关特征。

如果未提供命名空间，特征将自动分配给默认命名空间。

> [!IMPORTANT]
> 特征和命名空间不需要跨操作保持一致。 具体而言，一个命名空间可以具有不同操作的不同特征。 此外，可以为某些操作（而非其他操作）定义给定的命名空间。

来自相同字符串值本机特征的多个内部特征会被分组到相同的命名空间。 位于不同命名空间中的任何两个本机特征即使具有相同的特征名称，也将被视为不同。

> [!IMPORTANT]
> 虽然很长的描述性命名空间 ID 很常见，但在 ID 以相同字母开头的命名空间之间，VW 命令行并不存在差异。 如下所示，命名空间 ID 是单个字母，如 `x` 和 `y`。

实现详细信息如下所示：

- 要交叉命名空间 `x` 和 `y`，则写入 `-q xy` 或 `--quadratic xy`。 然后，`x` 中的每个特征与 `y` 中的每个特征交叉。 使用 `-q x:` 交叉每个命名空间的 `x`，并使用 `-q ::` 交叉命名空间的所有对。

- 要忽略命名空间 `x` 中的所有特征，则写入 `--ignore x`。

无论何时定义命名空间，这些命令都将分别应用于每个操作。

### <a name="estimated-average-as-a-feature"></a>以特征形式估计的平均值

作为思维实验，如果针对所有决策均选择此项，则给定操作的平均回报是什么？ 此类平均回报可以用来衡量此操作的“总体质量”。 在一些决策中改选其他操作时，并不总是确切知道相关信息。 但是，可以通过强化学习技术进行评估。 此评估质量通常会随着时间的推移得到改善。

可以选择包含此“预计平均回报”以作为给定操作的特征。 然后，新数据到达时，自定义 AI 决策服务将自动更新此评估。 此特征称为此操作的“边际特征”  。 边际特征可用于机器学习和审核。

要添加边际特征，则在 VW 命令行中写入 `--marginal <namespace>`。 在 JSON 中定义 `<namespace>`，如下所示：

```json
{<namespace>: {"mf_name":1 "action_id":1}
```

插入此命名空间以及给定操作的其他操作从属特征。 通过对所有决策使用相同的 `mf_name` 和 `action_id`，为每个决策提供此定义。

为包含 `<namespace>` 的每个操作添加边际特征。 `action_id` 可以是唯一标识操作的任何特征名称。 将特征名称设置为 `mf_name`。 具体而言，具有不同 `mf_name` 的边际特征被视为不同的特征 - 对于每个 `mf_name`，学习不同的权重。

默认使用情况为，对于所有操作 `mf_name` 均相同。 然后，对于所有边际特征，学习一个权重。

也可以为相同操作指定多个边际特征，具有相同值，但特征名称不同。

```json
{<namespace>: {"mf_name1":1 "action_id":1 "mf_name2":1 "action_id":1}}
```

### <a name="1-hot-encoding"></a>1-hot 编码

可以选择将一些特征表示为位矢量，其中每位对应于一系列可能的值。 此位设置为 1（仅当特征位于此范围时）。 因此，有一个“热”位设置为 1，其他位设置为 0。 此表示形式通常称为“1-hot 编码”  。

1-hot 编码通常适用于分类特征，如没有内在意义的数字表示的“地理区域”。 也是适用于对回报的影响很可能是非线性的数字特征。 例如，给定项目可能与特定年龄组相关，并且与年纪较大或较年轻的任何人都不相关。

默认情况下，任何字符串值特征是 1-hot 编码：为每个可能的值创建不同的内部特征。 当前未提供自动的数字特征 1-hot 编码和/或自定义范围。

> [!TIP]
> 机器学习算法以统一方式（通过常见的“权重”）处理给定内部特征的所有可能值。 1-hot 编码针对每个值范围支持单个“权重”。 收集足够数据后，缩小范围可改善回报，但可能会增加聚合所需的数据量才可改善回报。

## <a name="feature-specification-format-and-apis"></a>特征规范：格式和 API

可以通过辅助 API 指定特征。 所有 API 使用常见的 JSON 格式。 以下是概念级别的 API 和格式。 规范由 Swagger 架构进行补充。

特征规范的基本 JSON 模版如下所示：

```json
{
"<name>":<value>, "<name>":<value>, ... ,
"namespace1": {"<name>":<value>, ... },
"namespace2": {"<name>":<value>, ... },
...
}
```

此处，`<name>` 和 `<value>` 分别代表特征名称和特征值。 `<value>` 可以是字符串、整数、浮点数、布尔值或数组。 未包装入命名空间的特征将自动分配给默认命名空间。

要将字符串表示为“词包”，则使用特殊语法 `"_text":"string"` 而不是 `"<name>":<value>`。 实际上，将为字符串中的每个词创建单独的内部特征。 其值是此词的出现次数。

如果 `<name>` 以“_”开头（而非 `"_text"`），则此特征将被忽略。

> [!TIP]
> 有时，会从多个 JSON 源合并特征。 为方便起见，可以按如下方式表示它们：
>
> ```json
> {
> "source1":<features>,
> "source2":<features>,
> ...
> }
> ```

此处，`<features>` 指先前定义的基本特征规范。 也允许更深层次的“嵌套”。 自定义 AI 决策服务自动查找可以解释为 `<features>` 的“最深”JSON 对象。

#### <a name="feature-set-api"></a>特征集 API

特征集 API 按先前所述 JSON 格式返回特征列表。 可以使用多个特征集 API 终结点。 每个终结点由特征集 ID 和 URL 标识。 在门户上设置特征集 ID 和 URL 之间的映射。

通过在 JSON 中的适当位置插入相应的特征集 ID，来调用特征集 API。 对于操作从属特征，操作 ID 将自动参数化该调用。可以为同一操作指定多个特征集 ID。

#### <a name="action-set-api-json-version"></a>操作集 API（JSON 版本）

操作集 API 具有以 JSON 格式指定操作和特征的版本。 可以显式指定和/或通过特征集 API 指定特征。 可以为所有操作一次性指定共享特征。

#### <a name="ranking-api-http-post-call"></a>排名 API（HTTP POST 调用）

排名 API 具有使用 HTTP POST 调用的版本。 此调用的正文通过灵活的 JSON 语法指定操作和特征。

可以显式指定和/或通过操作集 API 指定操作。 无论何时遇到操作集 ID，均将执行对相应操作集 API 终结点的调用。

对于操作集 API，可以显式指定和/或通过特征集 API 指定特征。 可以为所有操作一次性指定共享特征。
