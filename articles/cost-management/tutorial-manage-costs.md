---
title: 教程 — 使用 Azure 中的 Cloudyn 管理成本 | Microsoft Docs
description: 本教程介绍如何使用成本分摊和报销与退款报表来管理成本。
services: cost-management
keywords: ''
author: bandersmsft
ms.author: banders
ms.date: 05/20/2019
ms.topic: tutorial
ms.service: cost-management
ms.custom: seodec18
manager: benshy
ms.openlocfilehash: b72e03f6901fbb2b904328992107e31021c76be6
ms.sourcegitcommit: e9a46b4d22113655181a3e219d16397367e8492d
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/21/2019
ms.locfileid: "65969119"
---
# <a name="tutorial-manage-costs-by-using-cloudyn"></a>教程：使用 Cloudyn 管理成本

通过基于标记分摊成本，在 Cloudyn 中管理成本和生成报销报表。 成本分摊过程可根据耗用的云资源进行成本分配。 当所有资源均使用标记进行分类时，成本将可以实现完全分摊。 完成成本分摊后，可以通过仪表板或报表向用户提供报销或退款。 但是，当你开始使用 Cloudyn 时，许多资源可能会没有标记或不可标记。

例如，你可能需要报销工程费用。 你需要能够根据资源成本向工程团队出示你需要报销的一个具体金额。 此时，你可以向他们提供所有已使用的标记为“工程”的资源。

在本文中，标记和类别有时是同义词。 类别是广泛的集合，可以表示很多元素。 它们可能包括业务单位、成本中心、Web 服务或任何标记的对象。 标记是名称/值对，通过将相同的标记应用到多个资源和资源组，可以对资源进行分类并查看和管理合并的帐单信息。 在早期版本的 Azure 门户中，*标记名称*被称为*键*。 标记针对单一 Azure 订阅创建并由其存储。 AWS 中的标记由键/值对组成。 由于 Azure 和 AWS 都使用了*键*这一术语，Cloudyn 也使用该术语。 类别管理器使用键（标记名称）来合并标记。

本教程介绍如何执行下列操作：

> [!div class="checklist"]
> * 使用自定义标记分摊成本。
> * 创建报销和退款报表。

如果还没有 Azure 订阅，可以在开始前创建一个[免费帐户](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)。

## <a name="prerequisites"></a>先决条件

- 必须具有 Azure 帐户。
- 必须有 Cloudyn 的试用注册版或付费订阅版。
- [必须在 Cloudyn 门户中激活未激活的帐户](activate-subs-accounts.md)。
- 必须在虚拟机上启用[来宾级别监视](azure-vm-extended-metrics.md)。


## <a name="use-custom-tags-to-allocate-costs"></a>使用自定义标记分摊成本

Cloudyn 从 Azure 获取资源组标记数据，并自动将标记信息传播到资源。 在成本分摊中，可以按资源标记查看成本。

借助成本分摊模型，可以定义内部应用于未分类（未标记）资源的类别（标记），以便对成本进行分组并定义处理未标记成本的规则。 成本分摊规则是在某项服务的成本分发给一些其他服务时保存的说明。 之后，通过选择创建的模型，这些资源会在*成本分摊*报表中显示标记/类别。

请记住，*成本分析*报表中的这些资源不会显示标记信息。 此外，使用成本分摊在 Cloudyn 中应用的标记不会发送到 Azure，因此不会在 Azure 门户中看到它们。

开始成本分摊时，首先要做的是通过使用成本模型定义作用域。 成本模型不会更改成本，而是将其分发。 在创建成本模型时，按照成本实体、帐户或订阅，以及多个标记来细分数据。 常见的示例标记可能包括账单代码、成本中心或组名称。 此外，标记还可帮助你对组织的其他部分执行报销和退款操作。

若要创建自定义成本分摊模型，在报表菜单上选择“成本”&gt;“成本管理”&gt;“成本分摊 360°”。

![显示你在其中选择了“成本分摊 360”的仪表板的示例](./media/tutorial-manage-costs/cost-allocation-360.png)

在“成本分摊 360”页上，选择“添加”，然后输入成本模型的名称和描述。 选择所有帐户或单个帐户。 如果要使用单个帐户，可以从多个云服务提供程序中选择多个帐户。 接下来，单击“分类”，选择发现的标记对成本数据进行分类。 选择要包含在模型中的标记（类别）。 下例中选择了“单元”标记。

![显示成本模型分类的示例](./media/tutorial-manage-costs/cost-model01.png)

该示例显示 $19,680 未分类（不带标记）。

接下来，选择“未分类的资源”并选择存在未分摊成本的服务。 然后，定义规则来分摊成本。

例如，你可能想要使用 Azure 存储成本，并将成本平均分配到 Azure 虚拟机 (VM)。 为此，请依次选择“Azure/存储”服务、“与分类成正比”和“Azure/VM”。 然后选择“创建”。

![用于平均分配的成本模型分配规则示例](./media/tutorial-manage-costs/cost-model02.png)



在不同示例中，你可能需要将所有 Azure 网络成本分摊给组织中的特定业务单元。 为此，请选择“Azure/网络”服务，然后在“定义分摊规则”下选择“显式分发”。 然后，将分发百分比设置为 100，并在下图中选择业务单元 - G&amp;A：

![特定业务单元的成本模型分配规则示例](./media/tutorial-manage-costs/cost-model03.png)



对于所有剩余的未分类资源，请创建其他分配规则。

如果有任何未分配的 Amazon Web Services (AWS) 预留实例，可以将它们分配给带有“预留实例”的标记类别。

若要查看对分摊成本所做选择的相关信息，请选择“摘要”。 若要保存信息并稍后继续处理其他规则，选择“另存为草稿”。 或者，若要保存信息并使 Cloudyn 开始处理成本分摊模型，请选择“保存并激活”。

成本模型列表将显示新成本模型的“处理状态”。 在使用成本模型更新 Cloudyn 数据库之前，可能需要一些时间。 处理完成后，状态更新为“已完成”。 然后，可以从成本分析报表的“扩展筛选器”&gt;“成本模型”下的成本模型中查看数据。

### <a name="category-manager"></a>类别管理器

类别管理器是一项数据清理工具，可帮助你将多个类别（标记）的值合并以创建新类别。 它是一个简单的基于规则的工具，可以在其中选择一个类别并创建规则以合并现有的值。 例如，你可能有现有的 R&amp;D 和开发人员类别，其中二者都表示开发组。

在 Cloudyn 门户中，单击右上方的齿轮符号，然后选择“类别管理器”。 若要创建新类别，选择加号 (+)。 输入类别名称，然后在“键”下输入要包含在新类别中的类别键。

在定义规则时，可以使用 OR 条件添加多个值。 此外，还可以执行一些基本的字符串操作。 对于任一情况，单击“规则”右侧的省略号 (...)。

若要定义新规则，请在“规则”区域中创建新规则。 例如，在“规则”下输入“开发人员”，然后在“操作”下输入“R&amp;D”。 完成后，保存新类别。

下图显示为名为“工作负载”的新类别创建的规则示例：

![显示新建工作负荷类别的示例](./media/tutorial-manage-costs/category01.png)

### <a name="tag-sources-and-reports"></a>标记源和报告

Cloudyn 报告中的标记数据源自三个地方：

- 云提供程序资源 API
- 云提供程序计费 API
- 从以下源手动创建标记：
    - Cloudyn 实体标记 - 应用到 Cloudyn 实体的用户定义元数据
    - 类别管理器 - 数据清理工具，可用来根据应用于现有标记的规则创建新标记

若要在 Cloudyn 成本报表中查看云提供程序标记，必须使用成本分配 360 创建自定义成本分配模型。 为此，请转到“成本” > “成本管理” > “成本分配 360”，选择需要的标记，然后定义处理未标记成本的规则。 然后，创建新的成本模型。 稍后，可在成本分配分析中查看报表，对 Azure 资源标记执行查看、筛选和分类操作。

Azure 资源标记仅在“成本” > “成本分摊分析”报表中显示。

云提供程序计费标记显示在所有成本报表中。

Cloudyn 实体标记和手动创建的标记显示在所有成本报表中。


## <a name="create-showback-and-chargeback-reports"></a>创建报销和退款报表

组织用于执行报销和退款的方法大不相同。 但是，可以在 Cloudyn 门户中使用任意仪表板和报表作为任一用途的基础。 可以为组织中的任何人员提供用户访问权限，以便他们能够按需查看仪表板和报表。 所有成本分析报表都支持报销，因为它们向用户展示了他们所使用的资源。 而且，它们允许用户在组织中深入了解特定于他们组的成本或使用数据。

要查看成本分摊的结果，请打开“成本分析”报表并选择你创建的成本模型。 然后，根据成本模型中选择的一个或多个标记添加分组。

![显示新成本的数据示例的“成本分析”报表](./media/tutorial-manage-costs/cost-analysis.png)

可以轻松创建和保存针对特定组所使用的特定服务的报表。 例如，你可能拥有一个大量使用 Azure VM 的部门。 可以创建一个在 Azure VM 上筛选的报表来显示使用情况和成本。

如果你需要向其他团队提供快照数据，可以导出任何 PDF 或 CSV 格式的报表。


## <a name="next-steps"></a>后续步骤

本教程介绍了如何：

> [!div class="checklist"]
> * 使用自定义标记分摊成本。
> * 创建报销和退款报表。



请转到下一教程，了解对数据访问的控制。

> [!div class="nextstepaction"]
> [控制对数据的访问](tutorial-user-access.md)
