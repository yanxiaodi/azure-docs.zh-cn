---
title: Azure IoT 中心的设备配置最佳做法 | Microsoft Docs
description: 了解有关大规模配置 IoT 设备的最佳做法
author: chrisgre
ms.author: chrisgre
ms.date: 06/28/2019
ms.topic: conceptual
ms.service: iot-hub
services: iot-hub
ms.openlocfilehash: 33e77d63b958df292ee9b4ac8ded41f3693cb6bc
ms.sourcegitcommit: 9b80d1e560b02f74d2237489fa1c6eb7eca5ee10
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/01/2019
ms.locfileid: "67485810"
---
# <a name="best-practices-for-device-configuration-within-an-iot-solution"></a>IoT 解决方案中设备配置的最佳做法

Azure IoT 中心内的自动设备管理功能可将许多复杂且重复性的任务自动化，包括在大型设备阵列的整个生命周期内对其进行管理。 本文定义在开发和操作 IoT 解决方案时涉及到的各种角色的多种最佳做法。

* **IoT 硬件制造商/集成商：** 制造商 IoT 硬件集成商组装来自各个制造商或供应商制造或集成其他供应商 IoT 部署提供硬件的硬件。 参与固件、嵌入式操作系统和嵌入式软件的开发与集成。

* **IoT 解决方案开发人员：** IoT 解决方案的开发通常是由解决方案开发人员。 此开发人员可能是内部团队成员或专门从事此活动的系统集成商。 IoT 解决方案开发人员可从头开始开发 IoT 解决方案的各个组件、集成各种标准组件或开源组件，或自定义 [IoT 解决方案加速器](/azure/iot-accelerators/)。

* **IoT 解决方案操作员：** 部署 IoT 解决方案后，它需要长期操作、 监视、 升级和维护。 这些任务可由内部团队来完成，该团队由信息技术专业人员、硬件操作和维护团队，以及负责监督整体 IoT 基础结构行为是否正常的领域专业人员组成。

## <a name="understand-automatic-device-management-for-configuring-iot-devices-at-scale"></a>了解大规模配置 IoT 设备时的自动设备管理

自动设备管理包括[设备孪生](iot-hub-devguide-device-twins.md)和[模块孪生](iot-hub-devguide-module-twins.md)提供的、在云与设备之间同步所需状态和报告状态的诸多好处。 [自动设备配置](iot-hub-auto-device-config.md)自动更新大型孪生集和汇总进度和符合性。 以下概要步骤描述如何开发和使用自动设备管理：

* **IoT 硬件制造商/系统集成商**使用[设备孪生](iot-hub-devguide-device-twins.md)在嵌入式应用程序中实施设备管理功能。 这些功能可能包括固件更新、软件安装和更新，以及设置管理。

* **IoT 解决方案开发人员**使用[设备孪生](iot-hub-devguide-device-twins.md)和[自动设备配置](iot-hub-auto-device-config.md)实施设备管理操作的管理层。 该解决方案应该定义操作员界面来执行设备管理任务。

* **IoT 解决方案操作员**使用 IoT 解决方案执行设备管理任务，具体而言，包括将设备分组在一起、启动配置更改（例如固件更新）、监视进度，以及解决出现的问题。

## <a name="iot-hardware-manufacturerintegrator"></a>IoT 硬件制造商/系统集成商

下面是处理嵌入式软件开发的硬件制造商和系统集成商的最佳做法：

* **实现[设备孪生](iot-hub-devguide-device-twins.md):** 设备孪生启用同步所需的配置从云中并用于报告当前配置和设备属性。 最好是通过 [Azure IoT SDK](https://github.com/Azure/azure-iot-sdks) 在嵌入式应用程序内部实施设备孪生。 设备孪生非常适合用于配置，因为它们：

    * 支持双向通信。
    * 允许联网和离线设备状态。
    * 遵循最终一致性的原则。
    * 在云中完全可查询。

* **结构设备管理的设备孪生：** 设备孪生的组织结构，以便设备管理属性逻辑分组在一起为部分。 这可以实现配置更改的隔离，且不影响孪生中的其他节。 例如，在所需属性中为固件创建一个节，为软件创建另一个节，并为网络设置创建第三个节。 

* **报表可用于设备管理的设备属性：** 物理设备等属性品牌和型号，固件、 操作系统、 序列号和其他标识符可用于报告以及为目标的配置更改的参数。

* **定义用于报告的状态和进度的主要状态：** 应枚举顶级状态，以便可以将它们报告给运算符。 例如，固件更新会将状态报告为“当前”、“正在下载”、“正在应用”、“正在进行”和“错误”。 定义其他字段，以获取有关每种状态的详细信息。

## <a name="iot-solution-developer"></a>IoT 解决方案开发商

下面是构建基于 Azure 的系统的 IoT 解决方案开发人员的最佳做法：

* **实现[设备孪生](iot-hub-devguide-device-twins.md):** 设备孪生启用同步所需的配置从云中并用于报告当前配置和设备属性。 最好是通过 [Azure IoT SDK](https://github.com/Azure/azure-iot-sdks) 在云解决方案应用程序内部实施设备孪生。 设备孪生非常适合用于配置，因为它们：

    * 支持双向通信。
    * 允许联网和离线设备状态。
    * 遵循最终一致性的原则。
    * 在云中完全可查询。

* **组织设备使用设备孪生标记：** 该解决方案应允许运算符来定义质量环或基于如 canary 的各种部署策略的设备的其他设置。 可以使用设备孪生标记和[查询](iot-hub-devguide-query-language.md)在解决方案内部实施设备组织。 需要通过设备组织以安全准确的方式实现配置实施。

* **实现[自动设备配置](iot-hub-auto-device-config.md):** 自动设备配置部署和监视配置更改为大量 IoT 设备通过设备孪生。

   自动设备配置通过**目标条件**（针对设备孪生标记或报告属性执行的查询）将设备孪生集指定为目标。 **目标内容**是要在目标设备孪生内部设置的所需属性集。 目标内容应与 IoT 硬件制造商/系统集成商定义的设备孪生结构相符。 **指标**为查询设备孪生报告属性和也应与 IoT 硬件制造商/集成商定义的设备孪生结构保持一致。

   自动设备配置运行首次创建的配置后不久和，然后在五分钟的时间间隔。 他们还可从 IoT 中心设备孪生操作不会超过的速率执行获益[节流限制](iot-hub-devguide-quotas-throttling.md)针对设备孪生读取和更新。

* **使用[设备预配服务](../iot-dps/how-to-manage-enrollments.md):** 解决方案开发人员应使用设备预配服务将设备孪生标记分配给新的设备，以便它们将自动配置通过**自动设备配置**面向孪生带有该标记。 

## <a name="iot-solution-operator"></a>IoT 解决方案操作员

下面是使用基于 Azure 的 IoT 解决方案的 IoT 解决方案操作员的最佳做法：

* **组织进行管理的设备：** IoT 解决方案应定义或允许的质量环创建或其他集基于如 canary 的各种部署策略的设备。 设备集将用于实施配置更改，以及执行其他大规模的设备管理操作。

* **执行使用分阶段的转出的配置更改：** 分阶段的转出是凭此运算符将更改部署到一组逐渐 IoT 设备的总体流程。 这样做的目的是逐渐进行更改，降低进行大规模重大更改的风险。  操作员应使用解决方案的界面来创建[自动设备配置](iot-hub-auto-device-config.md)，目标条件应该针对最初的设备集（例如 canary 组）。 然后，操作员应验证最初设备集中的配置更改。

   完成验证后，操作员将更新自动设备配置，以包含更大的设备集。 操作员还应将配置的优先级设置为高于当前针对这些设备的配置。 可以使用自动设备配置报告的指标来监视实施。

* **执行发生错误或配置错误时的回退：** 可以通过更改回回滚将导致错误配置的设备自动配置**目标条件**，以便设备不再满足目标条件。 确保优先级更低的另一自动设备配置仍然针对这些设备。 验证成功回滚查看度量值：回滚配置应不再显示适用于无目标设备的状态和第二个配置的度量值现在应包含的设备仍为目标的计数。

## <a name="next-steps"></a>后续步骤

* 在[了解并在 IoT 中心内使用设备孪生](iot-hub-devguide-device-twins.md)中了解如何实施设备孪生。

* 在[大规模配置和监视 IoT 设备](iot-hub-auto-device-config.md)中演练创建、更新或删除自动设备配置的步骤。

* 实现使用设备孪生和在配置自动设备的固件更新模式[教程：实现设备固件更新过程](tutorial-firmware-update.md)。
