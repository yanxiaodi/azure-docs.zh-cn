---
title: 在 Azure IoT Central 应用程序中设置设备模板 | Microsoft Docs
description: 了解如何使用度量、设置、属性、规则和仪表板设置设备模板。
author: viv-liu
ms.author: viviali
ms.date: 06/19/2019
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: peterpr
ms.openlocfilehash: 63c0a04a6d18d6af850b1492d2efa9df9aa65219
ms.sourcegitcommit: b3bad696c2b776d018d9f06b6e27bffaa3c0d9c3
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/21/2019
ms.locfileid: "69877378"
---
# <a name="set-up-a-device-template"></a>设置设备模板

[!INCLUDE [iot-central-original-pnp](../../includes/iot-central-original-pnp-note.md)]

设备模板是一个蓝图，用于定义可连接到 Azure IoT Central 应用程序的某种设备的特征和行为。

例如, 生成器可以为连接的风扇创建具有以下特征的设备模板:

- 温度遥测度量
- 位置度量
- 风扇电机错误事件度量
- 风扇运行状态度量
- 风扇速度设置
- 发送警报的规则
- 显示设备全方位视图的仪表板

在此设备模板中，操作员可以创建和连接名为 **fan-1** 和 **fan-2** 等的真实风扇设备。 所有风扇都具有度量、设置、属性、规则和仪表板，应用程序用户可对其进行监视和管理。

> [!NOTE]
> 只有构建人员和管理员可以创建、编辑和删除设备模板。 任何用户都可以在“Device Explorer”页中基于现有的设备模板创建设备。

## <a name="create-a-device-template"></a>创建设备模板

1. 转到“设备模板”页。

2. 若要创建模板, 请首先选择 " **+ 新建**"。

3. 若要快速开始, 请从现有的预先生成的模板中进行选择。 否则, 请选择 "**自定义**", 输入名称, 然后单击 "**创建**" 以从头开始构建自己的模板。

   ![设备模板库](./media/howto-set-up-template/newtemplate.png)

4. 当你创建自定义模板时, 你将看到新设备模板的 "**设备详细信息**" 页。 IoT Central 在你创建设备模板时自动创建模拟设备。 使用模拟设备，可以在连接实际设备前先测试应用程序行为。

下面各部分介绍了“设备模板”页上的每个选项卡。

## <a name="measurements"></a>度量

度量是来自设备的数据。 可将多个度量添加到设备模板，以匹配设备的功能。

- 遥测度量是设备在一段时间内收集的数字型数据点。 它们以连续数据流的形式显示。 例如温度。
- 事件度量是表示设备上发生的重要事情的时间点数据。 严重级别表示事件的重要程度。 例如风扇电机错误。
- **状态**度量表示设备或其组件在一段时间内的状态。 例如，可将“正在运行”和“已停止”定义为风扇模式的两种可能状态。
- **位置**度量是设备在中的一段时间内的经度和纬度坐标。 例如, 可以将一个风扇从一个位置移动到另一个位置。

### <a name="create-a-telemetry-measurement"></a>创建遥测度量

若要添加新的遥测度量值, 请选择 " **+ 新度量**值", 选择 "**遥测**" 作为度量类型, 并在窗体上输入详细信息。

> [!NOTE]
> 设备模板中的字段名称必须与相应设备代码中的属性名称匹配，这样，在连接真实设备后，应用程序中才会显示遥测度量。 在后续部分继续定义设备模板的过程中配置设置、设备属性和命令时，也必须做到这一点。

例如，可以添加新的温度遥测度量：

| 显示名        | 字段名    |  单位    | 最小值   |最大|
| --------------------| ------------- |-----------|-------|---|
| 温度         | temp          |  degC     |  0    |100|

![包含温度度量详细信息的“创建遥测”窗体](./media/howto-set-up-template/measurementsform.png)

选择“保存”后，度量列表中会出现“温度”度量。 不久便能看到模拟设备中的温度数据的可视化效果。

显示遥测数据时, 可以从以下聚合选项中进行选择:平均值、最小值、最大值、总和和计数。 选择**Average**作为图表上的默认聚合。

> [!NOTE]
> 遥测度量的数据类型是一个浮点数。

### <a name="create-an-event-measurement"></a>创建事件度量

若要添加新的事件度量, 请选择 " **+ 新度量值**", 并选择 "**事件**" 作为度量类型。 在“创建事件”窗体中输入详细信息。

提供了事件“显示名称”、“字段名称”和“严重性”的详细信息。 可以从三个严重性级别中进行选择：“错误”、“警告”和“信息”。

例如，可以添加新的“风扇电机错误”事件。

| 显示名        | 字段名    |  默认严重性 |
| --------------------| ------------- |-----------|
| 风扇电机错误     | fanmotorerror |  Error    |

![包含风扇电机事件详细信息的“创建事件”窗体](./media/howto-set-up-template/eventmeasurementsform.png)

选择“保存”后，度量列表中会出现“风扇电机错误”度量。 不久便能看到模拟设备中的事件数据的可视化效果。

若要查看有关事件的更多详细信息, 请在图表中选择事件图标:

![“风扇电机错误”事件详细信息](./media/howto-set-up-template/eventmeasurementsdetail.png)

> [!NOTE]
> 事件度量的数据类型为字符串。

### <a name="create-a-state-measurement"></a>创建状态度量

若要添加新的状态度量, 请选择 " **+ 新建度量值**" 按钮, 并选择 "**状态**" 作为度量类型。 在“创建状态”窗体中输入详细信息。

提供了状态“显示名称”、“字段名称”和“值”的详细信息。 每个值还可能附带一个显示名称，在图表和表格中显示该值时，会使用该名称。

例如，可以添加新的“风扇模式”状态，其中包含设备可以发送的两个可能值：“正在运行”和“已停止”。

| 显示名 | 字段名    |  值 1   | 显示名 | 值 2    |显示名  |
| -------------| ------------- |----------- | -------------| -----------| -------------|
| 风扇模式     | fanmode       |  1         | 正在运行    |     0      | 已停止      |

![带有风扇模式详细信息的“编辑状态”窗体](./media/howto-set-up-template/statemeasurementsform.png)

选择“保存”后，度量列表中会出现“风扇模式”状态度量。 不久便能看到模拟设备中的状态数据的可视化效果。

如果设备在短时间内发送了过多的数据点，状态度量会以不同的视觉效果显示。 选择图表以按时间顺序查看该时间段内的所有数据点。 还可以缩小时间范围，以查看图表上绘制的度量值。

> [!NOTE]
> 状态度量的数据类型为字符串。

### <a name="create-a-location-measurement"></a>创建位置度量

若要添加新的位置度量, 请选择 " **+ 新度量值**", 选择 "**位置**" 作为度量类型, 然后在 "**创建度量值**" 窗体上输入详细信息。

例如, 可以添加新的位置遥测度量值:

| 显示名        | 字段名    |
| --------------------| ------------- |
| 资产位置      |  assetloc     |

!["创建位置" 窗体, 其中包含位置度量的详细信息](./media/howto-set-up-template/locationmeasurementsform.png)

选择 "**保存**" 后,**位置**度量将显示在度量值列表中。 在短期内, 你会看到模拟设备中的位置数据的可视化效果。

显示位置时, 可以从以下选项中进行选择: 最新位置和位置历史记录。 仅在所选时间范围内应用**位置历史记录**。

位置度量值的数据类型是包含经度、纬度和可选高度的对象。 以下代码片段显示了 JavaScript 结构:

```javascript
assetloc: {
  lon: floating point number,
  lat: floating point number,
  alt?: floating point number
}
```

连接实际设备后, 将使用设备发送的值更新作为度量添加的位置。 配置位置度量值后, 可以[添加一个地图, 以直观显示设备仪表板中的位置](#add-a-location-measurement-in-the-dashboard)。

## <a name="settings"></a>设置

设置用于控制设备。 使用设置，操作员可以向设备提供输入。 可将多个设置添加到设备模板。这些设置将在“设置”选项卡上显示为可供操作员使用的磁贴。 您可以添加许多类型的设置: 数字、文本、日期、切换和节标签。

设置可以处于三种状态之一。 设备会报告这些状态。

- **已同步**：设备已更改为反映设置值。

- **Pending**：设备目前正在更改为设置值。

- **错误**：设备返回了错误。

例如, 可以通过选择 "**设置**" 并在 "新**数字**" 设置中输入来添加新的 "风扇速度" 设置:

| 显示名  | 字段名    |  单位  | 小数 |初始|
| --------------| ------------- |---------| ---------|---- |
| 风扇速度     | fanSpeed      | RPM     | 2        | 0   |

![包含速度设置详细信息的“配置编号”窗体](./media/howto-set-up-template/settingsform.png)

在你选择“保存”后，“风扇速度”设置便会显示为磁贴。 操作员可以在“Device Explorer”页上使用此设置来更改设备的风扇速度。

## <a name="properties"></a>属性

属性是与设备关联的元数据, 如固定设备位置和序列号。 将多个属性添加到设备模板，这些属性在“属性”选项卡上显示为磁贴。属性具有类型, 如数字、文本、日期、切换、设备属性、标签或固定位置。 操作员在创建设备时指定属性的值, 并且可随时编辑这些值。 设备属性是只读的，从设备发送到应用程序。 操作员无法更改设备属性。 当实际设备连接时, 设备属性磁贴会在应用程序中更新。

有两种类别的属性：

- 设备向 IoT Central 应用程序报告的设备属性。 设备属性是设备报告的只读值，当实际设备连接后在应用程序中更新。
- 存储在应用程序中、可由操作员编辑的应用程序属性。 应用程序属性仅存储在应用程序中, 不会被设备查看。

例如，在“属性”选项卡上，可以将设备的最近一次维修日期添加为新的“日期”属性（应用程序属性）：

| 显示名  | 字段名 | 初始值   |
| --------------| -----------|-----------------|
| 最后维修日期      | lastServiced        | 2019 年 1 月 29 日     |

![“属性”选项卡上的“配置最近一次维修日期”窗体](./media/howto-set-up-template/propertiesform.png)

在你选择“保存”后，设备的最近一次维修日期便会显示为磁贴。

创建磁贴后，可以在“Device Explorer”中更改应用程序属性值。

### <a name="create-a-location-property"></a>创建位置属性

可以在 Azure IoT Central 中将地理上下文指定为位置数据, 并映射任何纬度和经度坐标或街道地址。 Azure Maps 在 IoT Central 中启用此功能。

你可以添加两种类型的位置属性：

- **作为应用程序属性的位置**：存储在应用程序中。 应用程序属性仅存储在应用程序中, 不会被设备查看。
- **设备位置属性**，由设备向应用程序报告。 此类型的属性最适合用于静态位置。

> [!NOTE]
> 作为属性的位置不记录历史记录。 如果需要历史记录, 请使用位置度量。

#### <a name="add-location-as-an-application-property"></a>添加应用程序位置属性

可以在 IoT Central 应用程序中使用 Azure Maps 将位置属性创建为应用程序属性。 例如，可以添加设备安装地址：

1. 转到“属性”选项卡。

2. 在库中，选择“位置”。

3. 配置位置的显示名称、字段名称和初始值（可选）。

    | 显示名  | 字段名 | 初始值 |
    | --------------| -----------|---------|
    | 安装地址 | installAddress | Microsoft, 1 Microsoft Way, Redmond, WA 98052   |

   ![带有位置详细信息的“配置位置”窗体](./media/howto-set-up-template/locationcloudproperty2.png)

   有两种支持的格式可以添加位置：
   - **作为地址的位置**
   - **作为坐标的位置**

4. 选择**保存**。 操作员可以在“Device Explorer”中更新位置值。

#### <a name="add-location-as-a-device-property"></a>添加设备位置属性

可以将位置属性创建为由设备报告的设备属性。 例如，如果想要跟踪设备位置，则可以：

1. 转到“属性”选项卡。

2. 从库中选择“设备属性”。

3. 配置显示名称和字段名称，再选择“位置”作为数据类型：

    | 显示名  | 字段名 | 数据类型 |
    | --------------| -----------|-----------|
    | 设备位置 | deviceLocation | location  |

   > [!NOTE]
   > 字段名称必须与相应设备代码中的属性名称匹配

   ![带有位置详细信息的“配置设备属性”窗体](./media/howto-set-up-template/locationdeviceproperty2.png)

连接实际设备后, 你作为设备属性添加的位置将使用设备发送的值进行更新。 配置位置属性后, 可以[添加一个地图, 使其在设备仪表板中直观显示该位置](#add-a-location-property-in-the-dashboard)。

## <a name="commands"></a>命令

命令用于远程管理设备。 使用命令，操作员可以对设备运行命令。 可将多个命令添加到设备模板。这些命令将在“命令”选项卡上显示为可供操作员使用的磁贴。 作为设备的构建人员，你可以根据需要灵活地定义命令。

命令与设置有何不同？

- **设置**：设置是要应用于设备的配置。 除非你更改，否则设备一直采用相应配置。 例如，你希望设置冰箱的温度，即使冰箱重新启动也需要保持该设置。

- **命令**：使用命令，可以从 IoT Central 对设备即时远程运行命令。 如果未连接设备，则命令超时并失败。 例如，想要重新启动设备的情况。

例如, 你可以通过选择 "**命令**" 选项卡, 然后选择 " **+ 新建" 命令**并输入新的命令详细信息来添加新的**Echo**命令:

| 显示名  | 字段名 | 默认超时 | 数据类型 |
| --------------| -----------|---------------- | --------- |
| 回显命令  | echo       |  30             | text      |

![包含 echo 详细信息的“配置命令”窗体](./media/howto-set-up-template/commandsecho1.png)

在你选择“保存”后，“回显”命令便会显示为磁贴，并可供在“Device Explorer”中使用（当实际设备连接后）。 命令的字段名称必须与相应设备代码中的属性名称相匹配, 命令才能成功运行。

[下面是示例 C 设备代码的链接。](https://github.com/Azure/iot-central-firmware/blob/ad40358906aeb8f2040a822ba5292df866692c16/MXCHIP/mxchip_advanced/src/AzureIOTClient.cpp#L34)

## <a name="rules"></a>规则

操作员可以使用规则近乎实时地监视设备。 规则会自动调用操作，例如，在触发规则时发送电子邮件。 目前只有一种类型的规则：

- 当选定的设备遥测超过指定的阈值时，会触发遥测规则。 [详细了解遥测规则](howto-create-telemetry-rules.md)。

## <a name="dashboard"></a>仪表板

操作员可以在仪表板中查看有关设备的信息。 作为生成器, 你将磁贴添加到此页, 以帮助操作员了解设备的行为方式。 可以添加多种类型的仪表板磁贴，如图像、折线图、条形图、关键绩效指标 (KPI)、设置和属性，以及标签。

例如，可以选择“仪表板”选项卡和库中的磁贴，从而添加“设置和属性”磁贴，以显示所选设置和属性的当前值：

![带有设置和属性详细信息的“配置设备详细信息”窗体](./media/howto-set-up-template/dashboardsettingsandpropertiesform1.png)

此时，如果查看“Device Explorer”中的仪表板，操作员可以看到磁贴。

### <a name="add-a-location-measurement-in-the-dashboard"></a>在仪表板中添加位置度量

如果配置了位置度量, 则可在设备仪表板中使用地图直观显示该位置。 对于位置度量, 您可以选择绘制位置历史记录。

1. 转到“仪表板”选项卡。

1. 在“设备仪表板”中，从库中选择“地图”。

1. 为地图指定标题。 下面的示例包含标题**设备当前位置**。 然后, 在 "**度量值**" 选项卡上选择先前配置的位置度量。在以下示例中, 选择了**资产位置**度量:

   ![带有标题和属性详细信息的“配置地图”窗体](./media/howto-set-up-template/locationcloudproperty5map.png)

1. 选择“保存”。 地图图块现在显示所选的位置。

可以调整地图磁贴的大小。 当操作员查看**Device Explorer**中的仪表板时, 您配置的所有仪表板磁贴 (包括位置地图) 都将可见。

### <a name="add-a-location-property-in-the-dashboard"></a>在仪表板中添加 location 属性

如果配置了位置属性, 则可以在设备仪表板中使用地图直观显示该位置。

1. 转到“仪表板”选项卡。

1. 在“设备仪表板”中，从库中选择“地图”。

1. 为地图指定标题。 下面的示例包含标题**设备当前位置**。 然后，选择之前在“属性”选项卡上配置的位置属性。在以下示例中, 选择了**设备位置**度量:

   ![为地图窗体配置标题和属性的详细信息](./media/howto-set-up-template/locationcloudproperty6map.png)

1. 选择**保存**。 地图图块现在显示所选的位置。

可以调整地图磁贴的大小。 当操作员查看**Device Explorer**中的仪表板时, 您配置的所有仪表板磁贴 (包括位置地图) 都将可见。

若要详细了解如何在 Azure IoT Central 中使用磁贴, 请参阅[使用仪表板磁贴](howto-use-tiles.md)。

## <a name="next-steps"></a>后续步骤

了解如何在 Azure IoT Central 应用程序中使用设备模板后，你可以：

- [创建新设备模板版本](howto-version-device-template.md)
- [将 MXChip IoT DevKit 设备连接到 Azure IoT Central 应用程序](howto-connect-devkit.md)
- [将一般客户端应用程序连接到 Azure IoT Central 应用程序 (node.js)](howto-connect-nodejs.md)
