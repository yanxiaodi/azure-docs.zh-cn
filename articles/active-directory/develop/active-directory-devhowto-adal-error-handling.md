---
title: 处理 Azure AD 身份验证库 (ADAL) 客户端的最佳实践时出错
description: 提供适用于 ADAL 客户端应用程序的错误处理指南和最佳做法。
services: active-directory
documentationcenter: ''
author: rwike77
manager: CelesteDG
ms.author: ryanwi
ms.service: active-directory
ms.subservice: develop
ms.custom: aaddev
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 02/27/2017
ms.collection: M365-identity-device-management
ms.openlocfilehash: c0c1bbbdf9b42dfe2b507f533ad1806e06991f33
ms.sourcegitcommit: bc3a153d79b7e398581d3bcfadbb7403551aa536
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/06/2019
ms.locfileid: "68835411"
---
# <a name="error-handling-best-practices-for-azure-active-directory-authentication-library-adal-clients"></a>Azure Active Directory 身份验证库 (ADAL) 客户端的错误处理最佳做法

本文提供开发人员在使用 ADAL 对用户进行身份验证时可能遇到的错误类型的相关指南。 使用 ADAL 时，开发人员可能会遇到几种情况并需要处理相关错误。 恰当的错误处理可确保卓越的最终用户体验，并减少最终用户需要登录的次数。

本文将探讨 ADAL 支持的每个平台的具体情况，以及应用程序应如何正确处理每种情况。 根据 ADAL API 提供的令牌获取模式，错误指南可分为两大类：

- **AcquireTokenSilent**：客户端尝试以无提示方式获取令牌（无 UI），如果 ADAL 不成功，则可能会失败。 
- **AcquireToken**：客户端可以尝试以无提示方式获取，但也可以执行交互式请求（需要登录）。

> [!TIP]
> 最好在使用 ADAL 和 Azure AD 时记录所有错误和异常。 日志不仅有助于了解应用程序的整体运行状况，而且在调试更广泛的问题时也可发挥重要作用。 虽然应用程序可以从某些错误中恢复，但它们可能会提示存在其他设计问题，需要更改代码才能解决。 
> 
> 出于上述原因，在实现本文档中提到的错误条件时，应记录错误代码和相应描述。 有关日志记录代码的示例，请参阅[错误和日志记录引用](#error-and-logging-reference)。 
>

## <a name="acquiretokensilent"></a>AcquireTokenSilent

AcquireTokenSilent 在保证最终用户不会看到用户界面 (UI) 的情况下尝试获取令牌。 自动获取在几种情况下可能会失败，需通过交互式请求或使用默认处理程序来处理。 以下各节将深入探讨每种情况的具体表现和处理方法。

操作系统生成一组错误，可能需要执行特定于应用程序的错误处理。 有关详细信息，请参阅[错误和日志记录引用](#error-and-logging-reference)中的“操作系统”错误部分。 

### <a name="application-scenarios"></a>应用程序方案

- [本机客户端](developer-glossary.md#native-client)应用程序（iOS、Android、.NET 桌面或 Xamarin）
- 调用[资源](developer-glossary.md#resource-server) (.NET) 的 [Web 客户端](developer-glossary.md#web-client)应用程序

### <a name="error-cases-and-actionable-steps"></a>错误情况和操作步骤

从根本上说，存在两种 AcquireTokenSilent 错误情况：

| 大小写 | 描述 |
|------|-------------|
| **情况 1**：通过交互式登录可解决错误 | 对于因缺少有效令牌而导致的错误，执行交互式请求是必要的。 具体而言，缓存查找和无效/过期的刷新令牌必须通过 AcquireToken 调用才能解决。<br><br>在这些情况下，需提示最终用户进行登录。 应用程序可以选择是在最终用户交互（如点击登录按钮）后立即执行交互式请求，还是稍后执行。 这一选择取决于应用程序所需的行为。<br><br>请参阅下一节中的代码，了解此特定情况及其诊断错误。|
| **情况 2**：通过交互式登录无法解决错误 | 对于网络和瞬间/临时错误或其他故障，执行交互式 AcquireToken 请求不能解决问题。 不必要的交互式登录提示也会使最终用户受挫。 对于大多数 AcquireTokenSilent 失败错误，ADAL 会自动尝试重试一次。<br><br>客户端应用程序也可稍后尝试重试，但执行此操作的时间和方式取决于应用程序的行为和所需的最终用户体验。 例如，应用程序可以在几分钟后执行 AcquireTokenSilent 重试，或者在响应某一最终用户操作时执行。 立即重试会导致应用程序中止，不应尝试这种方式。<br><br>后续重试失败并出现相同的错误，这并不意味着客户端应使用 AcquireToken 进行交互式请求，因为该方法不能解决错误。<br><br>请参阅下一节中的代码，了解此特定情况及其诊断错误。 |

### <a name="net"></a>.NET

以下指南提供了与 ADAL 方法有关的错误处理示例： 

- acquireTokenSilentAsync(...)
- acquireTokenSilentSync(…) 
- [已弃用] acquireTokenSilent(…)
- [已弃用] acquireTokenByRefreshToken(…) 

代码按如下所示进行实现：

```csharp
try{
    AcquireTokenSilentAsync(…);
} 

catch (AdalSilentTokenAcquisitionException e) {
    // Exception: AdalSilentTokenAcquisitionException
    // Caused when there are no tokens in the cache or a required refresh failed. 

    // Action: Case 1, resolvable with an interactive request. 
} 

catch(AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Action: Case 2, not resolvable with an interactive request.
    // Attempt retry after a timed interval or user action.
} 
    
catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET. 
    // e.ErrorCode contains the error code. 

    // Action: Case 2, not resolvable with an interactive request.
    // Attempt retry after a timed interval or user action.
    // Example Error: network_not_available, default case.
}
```

### <a name="android"></a>Android

以下指南提供了与 ADAL 方法有关的错误处理示例： 

- acquireTokenSilentSync(…)
- acquireTokenSilentAsync(...)
- [已弃用] acquireTokenSilent(…)

代码按如下所示进行实现：

```java
// *Inside callback*
public void onError(Exception e) {

    if (e instanceof AuthenticationException) {
        // Exception: AdalException
        // Represents a library exception generated by ADAL Android.
        // Error Code: e.getCode().

        // Errors: ADALError.ERROR_SILENT_REQUEST,
        // ADALError.AUTH_REFRESH_FAILED_PROMPT_NOT_ALLOWED,
        // ADALError.INVALID_TOKEN_CACHE_ITEM
        // Description: Request failed due to no tokens in
        // cache or failed a required refresh. 

        // Action: Case 1, resolvable with an interactive request. 

        // Action: Case 2, not resolvable with an interactive request.
        // Attempt retry after a timed interval or user action.
        // Example Errors: default case,
        // DEVICE_CONNECTION_IS_NOT_AVAILABLE, 
        // BROKER_AUTHENTICATOR_ERROR_GETAUTHTOKEN,
    }
}
```

### <a name="ios"></a>iOS

以下指南提供了与 ADAL 方法有关的错误处理示例： 

- acquireTokenSilentWithResource(…)

代码按如下所示进行实现：

```objc
[context acquireTokenSilentWithResource:[ARGS], completionBlock:^(ADAuthenticationResult *result) {
    if (result.status == AD_FAILED) {
        if ([error.domain isEqualToString:ADAuthenticationErrorDomain]){
            // Exception: AD_FAILED 
            // Represents a library error generated by ADAL Objective-C.
            // Error Code: result.error.code

            // Errors: AD_ERROR_SERVER_REFRESH_TOKEN_REJECTED, AD_ERROR_CACHE_NO_REFRESH_TOKEN
            // Description: No tokens in cache or failed a required token refresh failed. 
            // Action: Case 1, resolvable with an interactive request. 

            // Error: AD_ERROR_CACHE_MULTIPLE_USERS
            // Description: There was ambiguity in the silent request resulting in multiple cache items.
            // Action: Special Case, application should perform another silent request and specify the user using ADUserIdentifier. 
            // Can be caused in cases of a multi-user application. 

            // Action: Case 2, not resolvable with an interactive request.
            // Attempt retry after some time or user action.
            // Example Errors: default case,
            // AD_ERROR_CACHE_BAD_FORMAT
        }
    }
}]
```

## <a name="acquiretoken"></a>AcquireToken

AcquireToken 是用于获取令牌的默认 ADAL 方法。 在需要用户标识的情况下，AcquireToken 先尝试自动获取令牌，如有必要再显示 UI（除非通过 PromptBehavior.Never）。 在需要应用程序标识的情况下，AcquireToken 尝试获取令牌，但不显示 UI（因为没有最终用户）。 

处理 AcquireToken 错误时，错误处理取决于所在平台和应用程序想要实现的方案。 

操作系统也可生成一组错误，需根据特定的应用程序进行错误处理。 有关详细信息，请参阅[错误和日志记录引用](#error-and-logging-reference)中的“操作系统错误”。 

### <a name="application-scenarios"></a>应用程序方案

- 本机客户端应用程序（iOS、Android、.NET 桌面或 Xamarin）
- 调用资源 API 的 Web 应用程序 (.NET)
- 单页应用程序 (JavaScript)
- 服务到服务应用程序（.NET、Java）
  - 所有情况（包括代表）
  - 代表特定情况

### <a name="error-cases-and-actionable-steps-native-client-applications"></a>错误情况和操作步骤：本机客户端应用程序

生成本机客户端应用程序时，需考虑几种错误处理情况，它们与网络问题、暂时性故障以及其他特定于平台的错误有关。 在大多数情况下，应用程序不应立即执行重试，而应等到出现提示登录的最终用户交互时再重试。 

在少数特殊情况下，可通过一次重试解决问题。 例如，用户需要在设备上启用数据，或首次失败后完成 Azure AD 中转站下载的情况。 

失败时，应用程序可通过显示 UI 提示重试，使最终用户能够执行一些交互。 例如，如果设备出现脱机错误，显示“尝试再次登录”按钮，提示 AcquireToken 重试，而不是立即重试。 

本机应用程序中的错误处理可以按两种情况定义：

|  |  |
|------|-------------|
| **情况 1**：<br>不可重试错误（大多数情况下） | 1.不要尝试立即重试。 根据调用重试的特定错误显示最终用户 UI（“尝试再次登录”、“下载 Azure AD 中转站应用程序”等）。 |
| **情况 2**：<br>可重试错误 | 1.执行一次重试，因为最终用户可能已进入某种会带来成功的状态。<br><br>2.如果重试失败，请根据调用重试的特定错误显示最终用户 UI（“尝试再次登录”、“下载 Azure AD 中转站应用”等）。 |

> [!IMPORTANT]
> 如果通过自动调用向 ADAL 传递了一个用户帐户但失败，则后续的交互式请求允许最终用户使用其他帐户登录。 通过用户帐户成功执行 AcquireToken 操作后，应用程序必须验证登录的用户是否与应用程序的本地用户对象匹配。 不匹配并不会产生异常（目标 C 除外），但如果在身份验证请求之前本地已知该用户（如失败的自动调用），则需考虑异常情况。
>

#### <a name="net"></a>.NET

以下指南提供了与所有非自动 AcquireToken(…) ADAL 方法相关的错误处理示例，但以下方法除外： 

- AcquireTokenAsync(…, IClientAssertionCertification, …)
- AcquireTokenAsync(…,ClientCredential, …)
- AcquireTokenAsync(…,ClientAssertion, …)
- AcquireTokenAsync(…,UserAssertion,…)   

代码按如下所示进行实现：

```csharp
try {
    AcquireTokenAsync(…);
} 
    
catch(AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.
    
    // Design time consideration: Certain errors may be caused at development and exposed through this exception. 
    // Looking inside the description will give more guidance on resolving the specific issue. 

    // Action: Case 1: Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: default case

    } 

catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET.
    // e.ErrorCode contains the error code

    // Action: Case 1, Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: network_not_available, default case
}
```

> [!NOTE]
> ADAL .NET 存在额外的注意事项，因为它支持 PromptBehavior.Never，后者的行为与 AcquireTokenSilent 类似。
>

以下指南提供了与 ADAL 方法有关的错误处理示例： 

- acquireToken(…, PromptBehavior.Never)

代码按如下所示进行实现：

```csharp
    try {acquireToken(…, PromptBehavior.Never);
    } 

catch(AdalServiceException e) {
    // Exception: AdalServiceException represents 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Action: Case 1: Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: default case

} catch (AdalException e) {
    // Error Code: e.ErrorCode == "user_interaction_required"
    // Description: user_interaction_required indicates the silent request failed 
    // in a way that's resolvable with an interactive request.
    // Action: Resolvable with an interactive request. 

    // Action: Case 1, Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: network_not_available, default case
}
```

#### <a name="android"></a>Android

以下指南提供了与所有非自动 AcquireToken(…) ADAL 方法相关的错误处理示例。 

代码按如下所示进行实现：

```java
AcquireTokenAsync(…);

// *Inside callback*
public void onError(Exception e) {
    if (e instanceof AuthenticationException) {
        // Exception: AdalException 
        // Represents a library exception generated by ADAL Android.
        // Error Code: e.getCode();

        // Error: ADALError.BROKER_APP_INSTALLATION_STARTED
        // Description: Broker app not installed, user will be prompted to download the app. 

        // Action: Case 2, Retriable Error 
        // Perform a single retry. If that fails, only try again after user action. 

        // Action: Case 1, Non-Retriable 
        // Do not perform an immediate retry. Only retry after user action. 
        // Example Errors: default case, DEVICE_CONNECTION_IS_NOT_AVAILABLE
    }
}
```

#### <a name="ios"></a>iOS

以下指南提供了与所有非自动 AcquireToken(…) ADAL 方法相关的错误处理示例。 

代码按如下所示进行实现：

```objc
[context acquireTokenWithResource:[ARGS], completionBlock:^(ADAuthenticationResult *result) {
    if (result.status == AD_FAILED) {
        if ([error.domain isEqualToString:ADAuthenticationErrorDomain]){
            // Exception: AD_FAILED 
            // Represents a library error generated by ADAL ObjC.
            // Error Code: result.error.code 

            // Error: AD_ERROR_SERVER_WRONG_USER
            // Description: App passed a user into ADAL and the end user signed in with a different account. 
            // Action: Case 1, Non-retriable (as is) and up to the application on how to handle this case. 
            // It can attempt a new request without specifying the user, or use UI to clarify the user account to sign in. 

            // Action: Case 1, Non-Retriable 
            // Do not perform an immediate retry. Only retry after user action. 
            // Example Errors: default case
        }
    }
}]
```

### <a name="error-cases-and-actionable-steps-web-applications-that-call-a-resource-api-net"></a>错误情况和操作步骤：调用资源 API 的 Web 应用程序 (.NET)

若要生成 .NET Web 应用程序，且该应用程序使用资源的授权代码获取令牌，一般情况下，只需提供默认处理程序代码。 

以下指南提供了与 ADAL 方法有关的错误处理示例： 

- AcquireTokenByAuthorizationCodeAsync(…)

代码按如下所示进行实现：

```csharp
try {
    AcquireTokenByAuthorizationCodeAsync(…);
} 

catch (AdalException e) {
    // Exception: AdalException
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action or wait until much later. 
    // Example Errors: default case
}
```

### <a name="error-cases-and-actionable-steps-single-page-applications-adaljs"></a>错误情况和操作步骤：单页应用程序 (adal.js)

如果使用 adal.js 和 AcquireToken 生成单页应用程序，则错误处理代码与典型自动调用类似。 特别是在 adal.js 中，AcquireToken 从不显示 UI。 

AcquireToken 失败存在以下情况：

|  |  |
|------|-------------|
| **情况 1**：<br>可通过交互式式请求解决 | 1.如果 login() 失败，请勿立即执行重试。 仅在用户执行某一操作，提示重试后才重试。|
| **情况 2**：<br>不可通过交互式请求解决。 错误可重试。 | 1.执行一次重试，因为最终用户可能已进入某种会带来成功的状态。<br><br>2.如果重试失败，请根据调用重试的特定错误向最终用户显示操作（“尝试再次登录”）。 |
| 情况 3：<br>不可通过交互式请求解决。 错误不可重试。 | 1.不要尝试立即重试。 根据调用重试的特定错误向最终用户显示操作（“尝试再次登录”）。 |

代码按如下所示进行实现：

```javascript
AuthContext.acquireToken(…, function(error, errorDesc, token) {
    if (error || errorDesc) {
        // Represents any token acquisition failure that occurred. 
        // Error Code: error.indexOf("<ERROR_STRING>")

        // Errors: if (error.indexOf("interaction_required"))
        //         if (error.indexOf("login required"))
        // Description: ADAL wasn't able to silently acquire a token because of expire or fresh session. 
        // Action: Case 1, Resolvable with an interactive login() request. 

        // Error: if (error.indexOf("Token Renewal Failed")) 
        // Description: Timeout when refreshing the token.
        // Action: Case 2, Not resolvable interactively, error is retriable.
        // Perform a single retry. Only try again after user action.

        // Action: Case 3, Not resolvable interactively, error is not retriable. 
        // Do not perform an immediate retry. Only retry after user action.
        // Example Errors: default case
    }
}
```

### <a name="error-cases-and-actionable-steps-service-to-service-applications-net-only"></a>错误情况和操作步骤：服务到服务应用程序（仅 .NET）

如果生成使用 AcquireToken 的服务到服务应用程序，那么代码必须处理几个关键错误。 失败唯一的解决方法是将错误返回给调用应用（对于代表情况）或应用重试策略。 

#### <a name="all-scenarios"></a>所有情况

对于所有服务到服务应用程序情况，包括代表：

- 不要尝试立即重试。 ADAL 尝试对某些失败的请求执行一次重试。 
- 只有在用户或应用操作提示重试后才能继续重试。 例如，守护程序应用程序在某个设置间隔内未正常运行，应等到下一时间间隔再进行重试。

以下指南提供了与 ADAL 方法有关的错误处理示例： 

- AcquireTokenAsync(…, IClientAssertionCertification, …)
- AcquireTokenAsync(…,ClientCredential, …)
- AcquireTokenAsync(…,ClientAssertion, …)
- AcquireTokenAsync(…,UserAssertion, …)

代码按如下所示进行实现：

```csharp
try {
    AcquireTokenAsync(…);
} 

catch (AdalException e) {
    // Exception: AdalException
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action (if applicable) or wait until much later. 
    // Example Errors: default case
}  
```

#### <a name="on-behalf-of-scenarios"></a>代表情况

适用于所有代表服务到服务应用程序情况。

以下指南提供了与 ADAL 方法有关的错误处理示例： 

- AcquireTokenAsync(…, UserAssertion, …)

代码按如下所示进行实现：

```csharp
try {
AcquireTokenAsync(…);
} 

catch (AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Error: On-Behalf-Of Error Handler
    if (e.ErrorCode == "interaction_required") {
        // Description: The client needs to perform some action due to a config from admin. 
        // Action: Capture `claims` parameter inside ex.InnerException.InnerException.
        // Generate HTTP error 403 with claims, throw back HTTP error to client.
        // Wait for client to retry. 
    }
} 
        
catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action (if applicable) or wait until much later. 
    // Example Error: default case
}
```

已生成[完整的示例](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca)，该示例可演示这种情况。

## <a name="error-and-logging-reference"></a>错误和日志记录引用

### <a name="logging-personal-identifiable-information-pii--organizational-identifiable-information-oii"></a>记录个人身份信息 (PII) 和组织身份信息 (OII)
默认情况下，ADAL 日志记录不会捕获或记录任何 PII 或 OII。 库允许应用开发人员通过 Logger 类中的资源库启用该功能。 启用 PII 或 OII 后，应用负责安全地处理高度敏感的数据并遵守任何法规要求。

### <a name="net"></a>.NET

#### <a name="adal-library-errors"></a>ADAL 库错误

若要了解特定的 ADAL 错误，建议参考 [azure-activedirectory-library-for-dotnet 存储库](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/8f6d560fbede2247ec0e217a21f6929d4375dcaa/src/ADAL.PCL/Utilities/Constants.cs#L58)中的源代码。

#### <a name="guidance-for-error-logging-code"></a>错误日志记录代码指南

根据所在平台不同，ADAL .NET 日志记录有所更改。 有关如何启用日志记录的代码，请参阅[日志记录 wiki](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/wiki/Logging-in-ADAL.Net)。

### <a name="android"></a>Android

#### <a name="adal-library-errors"></a>ADAL 库错误

若要了解特定的 ADAL 错误，建议参考 [azure-activedirectory-library-for-android 存储库](https://github.com/AzureAD/azure-activedirectory-library-for-android/blob/dev/adal/src/main/java/com/microsoft/aad/adal/ADALError.java#L33)中的源代码。

#### <a name="operating-system-errors"></a>操作系统错误

Android OS 错误通过 ADAL 中的 AuthenticationException 显示，可识别为“SERVER_INVALID_REQUEST”，并且可通过错误描述进一步细化。 

有关常见错误以及应用或最终用户遇到这些错误时要执行的步骤的完整列表，请参阅 [ADAL Android Wiki](https://github.com/AzureAD/azure-activedirectory-library-for-android/wiki)。 

#### <a name="guidance-for-error-logging-code"></a>错误日志记录代码指南

```java
// 1. Configure Logger
Logger.getInstance().setExternalLogger(new ILogger() {    
    @Override   
    public void Log(String tag, String message, String additionalMessage, LogLevel level, ADALError errorCode) { 
    // …
    // You can write this to logfile depending on level or errorcode. 
    writeToLogFile(getApplicationContext(), tag +":" + message + "-" + additionalMessage);    
    }
}

// 2. Set the log level
Logger.getInstance().setLogLevel(Logger.LogLevel.Verbose);

// By default, the `Logger` does not capture any PII or OII

// PII or OII will be logged
Logger.getInstance().setEnablePII(true);

// To STOP logging PII or OII, use the following setter
Logger.getInstance().setEnablePII(false);


// 3. Send logs to logcat.
adb logcat > "C:\logmsg\logfile.txt";
```

### <a name="ios"></a>iOS

#### <a name="adal-library-errors"></a>ADAL 库错误

若要了解特定的 ADAL 错误，建议参考 [azure-activedirectory-library-for-objc 存储库](https://github.com/AzureAD/azure-activedirectory-library-for-objc/blob/dev/ADAL/src/ADAuthenticationError.m#L295)中的源代码。

#### <a name="operating-system-errors"></a>操作系统错误

用户使用 Web 视图和身份验证功能时，登录期间可能会出现 iOS 错误。 这可能是由 SSL 错误、超时或网络错误等情况引起的：

- 对于权利共享，不能永久登录且缓存显示为空。 通过将以下代码行添加到密钥链可解决该问题：`[[ADAuthenticationSettings sharedInstance] setSharedCacheKeychainGroup:nil];`
- 对于 NsUrlDomain 错误集，需根据应用逻辑更改操作。 有关可处理的特定实例，请参阅 [NSURLErrorDomain 参考文档](https://developer.apple.com/documentation/foundation/nsurlerrordomain#declarations)。
- 有关 ADAL Objective-C 团队维护的常见错误列表，请参阅 [ADAL Obj-C 常见问题](https://github.com/AzureAD/azure-activedirectory-library-for-objc#adauthenticationerror)。

#### <a name="guidance-for-error-logging-code"></a>错误日志记录代码指南

```objc
// 1. Enable NSLogging
[ADLogger setNSLogging:YES];

// 2. Set the log level (if you want verbose)
[ADLogger setLevel:ADAL_LOG_LEVEL_VERBOSE];

// 3. Set up a callback block to simply print out
[ADLogger setLogCallBack:^(ADAL_LOG_LEVEL logLevel, NSString *message, NSString *additionalInformation, NSInteger errorCode, NSDictionary *userInfo) {
     NSString* log = [NSString stringWithFormat:@"%@ %@", message, additionalInformation];    
     NSLog(@"%@", log);
}];
```

### <a name="guidance-for-error-logging-code---javascript"></a>错误日志记录代码指南 - JavaScript 

```javascript
0: Error1: Warning2: Info3: Verbose
window.Logging = {
    level: 3,
    log: function (message) {
        console.log(message);
    }
};
```
## <a name="related-content"></a>相关内容

* [Azure AD Developer's Guide][AAD-Dev-Guide]（Azure AD 开发人员指南）
* [Azure AD 身份验证库][AAD-Auth-Libraries]
* [Azure AD 身份验证方案][AAD-Auth-Scenarios]
* [将应用程序与 Azure Active Directory 集成][AAD-Integrating-Apps]

欢迎通过下方的“评论”部分提供反馈，帮助我们改进内容。

[![显示 "Microsoft 登录" 按钮][AAD-Sign-In]][AAD-Sign-In]
<!--Reference style links -->

[AAD-Auth-Libraries]: ./active-directory-authentication-libraries.md
[AAD-Auth-Scenarios]:authentication-scenarios.md
[AAD-Dev-Guide]:azure-ad-developers-guide.md
[AAD-Integrating-Apps]:quickstart-v1-integrate-apps-with-azure-ad.md
[AZURE-portal]: https://portal.azure.com

<!--Image references-->
[AAD-Sign-In]:./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png

